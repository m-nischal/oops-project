{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder/src/models/productModel.js"],"sourcesContent":["// models/productModel.js\nimport mongoose from \"mongoose\";\n\nconst sizeSchema = new mongoose.Schema({\n  label: { type: String, required: true },\n  stock: { type: Number, default: 0 },\n}, { _id: false });\n\nconst ratingSchema = new mongoose.Schema({\n  avg: { type: Number, default: 0 },\n  count: { type: Number, default: 0 },\n}, { _id: false });\n\n/**\n * Product schema - stores snapshot of product data and size-level stock.\n * Use integer currency values (e.g., rupees or paisa) consistently across the app.\n */\nconst productSchema = new mongoose.Schema({\n  name: { type: String, required: true },\n  price: { type: Number, required: true },\n  originalPrice: { type: Number, default: 0 },\n  description: { type: String, default: \"\" },\n  materials: { type: [String], default: [] },\n  images: { type: [String], default: [] },\n  sizes: { type: [sizeSchema], default: [] },\n  rating: { type: ratingSchema, default: () => ({}) },\n  category: { type: String, default: \"General\" }\n}, { timestamps: true });\n\n// Text index for full-text search on name and description\nproductSchema.index({ name: \"text\", description: \"text\" });\n\n// Prevent model overwrite in dev/hot-reload environments (Next.js etc.)\nconst Product = mongoose.models.Product || mongoose.model(\"Product\", productSchema);\n\nexport default Product;\n"],"names":[],"mappings":"AAAA,yBAAyB;;;;;AACzB;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,OAAO;QAAE,MAAM;QAAQ,SAAS;IAAE;AACpC,GAAG;IAAE,KAAK;AAAM;AAEhB,MAAM,eAAe,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACvC,KAAK;QAAE,MAAM;QAAQ,SAAS;IAAE;IAChC,OAAO;QAAE,MAAM;QAAQ,SAAS;IAAE;AACpC,GAAG;IAAE,KAAK;AAAM;AAEhB;;;CAGC,GACD,MAAM,gBAAgB,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACxC,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,eAAe;QAAE,MAAM;QAAQ,SAAS;IAAE;IAC1C,aAAa;QAAE,MAAM;QAAQ,SAAS;IAAG;IACzC,WAAW;QAAE,MAAM;YAAC;SAAO;QAAE,SAAS,EAAE;IAAC;IACzC,QAAQ;QAAE,MAAM;YAAC;SAAO;QAAE,SAAS,EAAE;IAAC;IACtC,OAAO;QAAE,MAAM;YAAC;SAAW;QAAE,SAAS,EAAE;IAAC;IACzC,QAAQ;QAAE,MAAM;QAAc,SAAS,IAAM,CAAC,CAAC,CAAC;IAAE;IAClD,UAAU;QAAE,MAAM;QAAQ,SAAS;IAAU;AAC/C,GAAG;IAAE,YAAY;AAAK;AAEtB,0DAA0D;AAC1D,cAAc,KAAK,CAAC;IAAE,MAAM;IAAQ,aAAa;AAAO;AAExD,wEAAwE;AACxE,MAAM,UAAU,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAC,WAAW;uCAEtD","debugId":null}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder/src/services/inventory.js"],"sourcesContent":["// src/services/inventory.js\nimport Product from \"models/productModel.js\";\n\n/**\n * @file InventoryService\n * @brief Centralized product stock operations (sizes array).\n *\n * Responsibilities:\n *  - Single-item atomic updates (increaseStock, decreaseStock)\n *  - Multi-item transactional decrement (decreaseStockForItems)\n *  - Safe helpers for adding sizes, checking stock, and total stock\n */\n\n/** Base error for inventory operations */\nclass InventoryError extends Error {}\n/** Thrown when requested qty cannot be satisfied */\nclass InsufficientStockError extends InventoryError {}\n/** Thrown when input params are invalid */\nclass InvalidParamsError extends InventoryError {}\n\nexport default class InventoryService {\n  /**\n   * Normalize size label defensively.\n   * @private\n   * @param {any} sizeLabel\n   * @returns {string}\n   */\n  static _normalizeLabel(sizeLabel) {\n    return sizeLabel === undefined || sizeLabel === null ? \"\" : String(sizeLabel).trim();\n  }\n\n  /**\n   * Validate and normalize params for single-item operations.\n   * Throws InvalidParamsError on invalid input.\n   * @private\n   * @param {String|ObjectId} productId\n   * @param {String} sizeLabel\n   * @param {Number} qty\n   * @returns {{productId:*, sizeLabel:string, qty:number}}\n   */\n  static _validateParams(productId, sizeLabel, qty) {\n    if (!productId) throw new InvalidParamsError(\"productId is required\");\n    const label = this._normalizeLabel(sizeLabel);\n    if (!label) throw new InvalidParamsError(\"sizeLabel is required\");\n    const q = Number(qty);\n    if (!Number.isFinite(q) || q <= 0) throw new InvalidParamsError(\"qty must be a positive number\");\n    return { productId, sizeLabel: label, qty: Math.floor(q) };\n  }\n\n  /**\n   * Decrease stock for a specific product size by qty.\n   * If a mongoose session is provided, the update participates in the transaction.\n   * @param {String|ObjectId} productId\n   * @param {String} sizeLabel\n   * @param {Number} qty\n   * @param {mongoose.ClientSession} [session]\n   * @returns {Promise<boolean>} true if modified, false otherwise\n   * @throws {InvalidParamsError}\n   */\n  static async decreaseStock(productId, sizeLabel, qty, session = null) {\n    const params = this._validateParams(productId, sizeLabel, qty);\n\n    const filter = {\n      _id: params.productId,\n      \"sizes.label\": params.sizeLabel,\n      \"sizes.stock\": { $gte: params.qty }\n    };\n\n    const update = { $inc: { \"sizes.$[el].stock\": -params.qty } };\n    const options = { arrayFilters: [{ \"el.label\": params.sizeLabel }] };\n    if (session) options.session = session;\n\n    const res = await Product.updateOne(filter, update, options);\n    return (res.modifiedCount ?? res.nModified ?? 0) > 0;\n  }\n\n  /**\n   * Increase stock for a specific product size by qty (restock/cancel).\n   * Returns true if an existing size was updated, false if not found (size missing).\n   * Use addOrCreateSize to add a missing size.\n   * @param {String|ObjectId} productId\n   * @param {String} sizeLabel\n   * @param {Number} qty\n   * @param {mongoose.ClientSession} [session]\n   * @returns {Promise<boolean>}\n   */\n  static async increaseStock(productId, sizeLabel, qty, session = null) {\n    const params = this._validateParams(productId, sizeLabel, qty);\n\n    const filter = { _id: params.productId, \"sizes.label\": params.sizeLabel };\n    const update = { $inc: { \"sizes.$[el].stock\": params.qty } };\n    const options = { arrayFilters: [{ \"el.label\": params.sizeLabel }] };\n    if (session) options.session = session;\n\n    const res = await Product.updateOne(filter, update, options);\n    return (res.modifiedCount ?? res.nModified ?? 0) > 0;\n  }\n\n  /**\n   * Add a new size entry if it doesn't exist, or set the stock if it does.\n   * @param {String|ObjectId} productId\n   * @param {String} sizeLabel\n   * @param {Number} qty\n   * @param {mongoose.ClientSession} [session]\n   * @returns {Promise<void>}\n   * @throws {InvalidParamsError}\n   */\n  static async addOrCreateSize(productId, sizeLabel, qty = 0, session = null) {\n    if (!productId) throw new InvalidParamsError(\"productId is required\");\n    const label = this._normalizeLabel(sizeLabel);\n    if (!label) throw new InvalidParamsError(\"sizeLabel is required\");\n    const q = Math.max(0, Math.floor(Number(qty) || 0));\n    const options = { arrayFilters: [{ \"el.label\": label }] };\n    if (session) options.session = session;\n\n    // Try update first; if not matched, push a new size\n    const res = await Product.updateOne(\n      { _id: productId, \"sizes.label\": label },\n      { $set: { \"sizes.$[el].stock\": q } },\n      options\n    );\n\n    if ((res.modifiedCount ?? res.nModified ?? 0) === 0) {\n      await Product.updateOne(\n        { _id: productId },\n        { $push: { sizes: { label, stock: q } } },\n        session ? { session } : {}\n      );\n    }\n  }\n\n  /**\n   * Get stock for a specific size. Returns 0 if product or size not found.\n   * @param {String|ObjectId} productId\n   * @param {String} sizeLabel\n   * @returns {Promise<number>}\n   */\n  static async getStock(productId, sizeLabel) {\n    if (!productId) throw new InvalidParamsError(\"productId is required\");\n    const label = this._normalizeLabel(sizeLabel);\n    if (!label) throw new InvalidParamsError(\"sizeLabel is required\");\n\n    const doc = await Product.findById(productId, { sizes: 1 }).lean();\n    if (!doc || !Array.isArray(doc.sizes)) return 0;\n    const s = doc.sizes.find(x => String(x.label).trim() === label);\n    return s ? Number(s.stock || 0) : 0;\n  }\n\n  /**\n   * Returns total stock across all sizes for the product (integer).\n   * @param {String|ObjectId} productId\n   * @returns {Promise<number>}\n   */\n  static async totalStock(productId) {\n    if (!productId) throw new InvalidParamsError(\"productId is required\");\n    const doc = await Product.findById(productId, { sizes: 1 }).lean();\n    if (!doc || !Array.isArray(doc.sizes)) return 0;\n    return doc.sizes.reduce((sum, s) => sum + Math.max(0, Number(s.stock || 0)), 0);\n  }\n\n  /**\n   * Decrease stock for multiple items inside a session/transaction.\n   * This method expects a mongoose session that has had startTransaction called.\n   * It will throw InsufficientStockError if any individual decrement cannot be applied.\n   *\n   * @param {Array<{productId: string, sizeLabel: string, qty: number}>} items\n   * @param {mongoose.ClientSession} session - required\n   * @returns {Promise<void>}\n   * @throws {InvalidParamsError|InsufficientStockError}\n   */\n  static async decreaseStockForItems(items = [], session) {\n    if (!Array.isArray(items) || items.length === 0) return;\n    if (!session) throw new InvalidParamsError(\"A mongoose session is required for multi-item decrease\");\n\n    // Validate items and normalize labels\n    for (const it of items) {\n      it.sizeLabel = this._normalizeLabel(it.sizeLabel);\n      this._validateParams(it.productId, it.sizeLabel, it.qty);\n    }\n\n    // Attempt each update; on failure fetch available and throw InsufficientStockError\n    for (const it of items) {\n      const updated = await Product.updateOne(\n        {\n          _id: it.productId,\n          \"sizes.label\": it.sizeLabel,\n          \"sizes.stock\": { $gte: it.qty }\n        },\n        { $inc: { \"sizes.$[el].stock\": -it.qty } },\n        { arrayFilters: [{ \"el.label\": it.sizeLabel }], session }\n      );\n\n      const modified = (updated.modifiedCount ?? updated.nModified ?? 0) > 0;\n      if (!modified) {\n        const current = await Product.findOne(\n          { _id: it.productId, \"sizes.label\": it.sizeLabel },\n          { \"sizes.$\": 1 }\n        ).session(session).lean();\n\n        const available = current && current.sizes && current.sizes[0] ? Number(current.sizes[0].stock || 0) : 0;\n        throw new InsufficientStockError(\n          `Insufficient stock for product ${it.productId} size ${it.sizeLabel}. Requested ${it.qty}, available ${available}`\n        );\n      }\n    }\n    // all decrements succeeded (still inside caller's transaction)\n  }\n}\n\n// Export error classes for callers that want to check error types.\nexport { InventoryError, InsufficientStockError, InvalidParamsError };\n"],"names":[],"mappings":"AAAA,4BAA4B;;;;;;;;;;;AAC5B;;AAEA;;;;;;;;CAQC,GAED,wCAAwC,GACxC,MAAM,uBAAuB;AAAO;AACpC,kDAAkD,GAClD,MAAM,+BAA+B;AAAgB;AACrD,yCAAyC,GACzC,MAAM,2BAA2B;AAAgB;AAElC,MAAM;IACnB;;;;;GAKC,GACD,OAAO,gBAAgB,SAAS,EAAE;QAChC,OAAO,cAAc,aAAa,cAAc,OAAO,KAAK,OAAO,WAAW,IAAI;IACpF;IAEA;;;;;;;;GAQC,GACD,OAAO,gBAAgB,SAAS,EAAE,SAAS,EAAE,GAAG,EAAE;QAChD,IAAI,CAAC,WAAW,MAAM,IAAI,mBAAmB;QAC7C,MAAM,QAAQ,IAAI,CAAC,eAAe,CAAC;QACnC,IAAI,CAAC,OAAO,MAAM,IAAI,mBAAmB;QACzC,MAAM,IAAI,OAAO;QACjB,IAAI,CAAC,OAAO,QAAQ,CAAC,MAAM,KAAK,GAAG,MAAM,IAAI,mBAAmB;QAChE,OAAO;YAAE;YAAW,WAAW;YAAO,KAAK,KAAK,KAAK,CAAC;QAAG;IAC3D;IAEA;;;;;;;;;GASC,GACD,aAAa,cAAc,SAAS,EAAE,SAAS,EAAE,GAAG,EAAE,UAAU,IAAI,EAAE;QACpE,MAAM,SAAS,IAAI,CAAC,eAAe,CAAC,WAAW,WAAW;QAE1D,MAAM,SAAS;YACb,KAAK,OAAO,SAAS;YACrB,eAAe,OAAO,SAAS;YAC/B,eAAe;gBAAE,MAAM,OAAO,GAAG;YAAC;QACpC;QAEA,MAAM,SAAS;YAAE,MAAM;gBAAE,qBAAqB,CAAC,OAAO,GAAG;YAAC;QAAE;QAC5D,MAAM,UAAU;YAAE,cAAc;gBAAC;oBAAE,YAAY,OAAO,SAAS;gBAAC;aAAE;QAAC;QACnE,IAAI,SAAS,QAAQ,OAAO,GAAG;QAE/B,MAAM,MAAM,MAAM,iIAAO,CAAC,SAAS,CAAC,QAAQ,QAAQ;QACpD,OAAO,CAAC,IAAI,aAAa,IAAI,IAAI,SAAS,IAAI,CAAC,IAAI;IACrD;IAEA;;;;;;;;;GASC,GACD,aAAa,cAAc,SAAS,EAAE,SAAS,EAAE,GAAG,EAAE,UAAU,IAAI,EAAE;QACpE,MAAM,SAAS,IAAI,CAAC,eAAe,CAAC,WAAW,WAAW;QAE1D,MAAM,SAAS;YAAE,KAAK,OAAO,SAAS;YAAE,eAAe,OAAO,SAAS;QAAC;QACxE,MAAM,SAAS;YAAE,MAAM;gBAAE,qBAAqB,OAAO,GAAG;YAAC;QAAE;QAC3D,MAAM,UAAU;YAAE,cAAc;gBAAC;oBAAE,YAAY,OAAO,SAAS;gBAAC;aAAE;QAAC;QACnE,IAAI,SAAS,QAAQ,OAAO,GAAG;QAE/B,MAAM,MAAM,MAAM,iIAAO,CAAC,SAAS,CAAC,QAAQ,QAAQ;QACpD,OAAO,CAAC,IAAI,aAAa,IAAI,IAAI,SAAS,IAAI,CAAC,IAAI;IACrD;IAEA;;;;;;;;GAQC,GACD,aAAa,gBAAgB,SAAS,EAAE,SAAS,EAAE,MAAM,CAAC,EAAE,UAAU,IAAI,EAAE;QAC1E,IAAI,CAAC,WAAW,MAAM,IAAI,mBAAmB;QAC7C,MAAM,QAAQ,IAAI,CAAC,eAAe,CAAC;QACnC,IAAI,CAAC,OAAO,MAAM,IAAI,mBAAmB;QACzC,MAAM,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,OAAO,QAAQ;QAChD,MAAM,UAAU;YAAE,cAAc;gBAAC;oBAAE,YAAY;gBAAM;aAAE;QAAC;QACxD,IAAI,SAAS,QAAQ,OAAO,GAAG;QAE/B,oDAAoD;QACpD,MAAM,MAAM,MAAM,iIAAO,CAAC,SAAS,CACjC;YAAE,KAAK;YAAW,eAAe;QAAM,GACvC;YAAE,MAAM;gBAAE,qBAAqB;YAAE;QAAE,GACnC;QAGF,IAAI,CAAC,IAAI,aAAa,IAAI,IAAI,SAAS,IAAI,CAAC,MAAM,GAAG;YACnD,MAAM,iIAAO,CAAC,SAAS,CACrB;gBAAE,KAAK;YAAU,GACjB;gBAAE,OAAO;oBAAE,OAAO;wBAAE;wBAAO,OAAO;oBAAE;gBAAE;YAAE,GACxC,UAAU;gBAAE;YAAQ,IAAI,CAAC;QAE7B;IACF;IAEA;;;;;GAKC,GACD,aAAa,SAAS,SAAS,EAAE,SAAS,EAAE;QAC1C,IAAI,CAAC,WAAW,MAAM,IAAI,mBAAmB;QAC7C,MAAM,QAAQ,IAAI,CAAC,eAAe,CAAC;QACnC,IAAI,CAAC,OAAO,MAAM,IAAI,mBAAmB;QAEzC,MAAM,MAAM,MAAM,iIAAO,CAAC,QAAQ,CAAC,WAAW;YAAE,OAAO;QAAE,GAAG,IAAI;QAChE,IAAI,CAAC,OAAO,CAAC,MAAM,OAAO,CAAC,IAAI,KAAK,GAAG,OAAO;QAC9C,MAAM,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,CAAA,IAAK,OAAO,EAAE,KAAK,EAAE,IAAI,OAAO;QACzD,OAAO,IAAI,OAAO,EAAE,KAAK,IAAI,KAAK;IACpC;IAEA;;;;GAIC,GACD,aAAa,WAAW,SAAS,EAAE;QACjC,IAAI,CAAC,WAAW,MAAM,IAAI,mBAAmB;QAC7C,MAAM,MAAM,MAAM,iIAAO,CAAC,QAAQ,CAAC,WAAW;YAAE,OAAO;QAAE,GAAG,IAAI;QAChE,IAAI,CAAC,OAAO,CAAC,MAAM,OAAO,CAAC,IAAI,KAAK,GAAG,OAAO;QAC9C,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,KAAK,GAAG,CAAC,GAAG,OAAO,EAAE,KAAK,IAAI,KAAK;IAC/E;IAEA;;;;;;;;;GASC,GACD,aAAa,sBAAsB,QAAQ,EAAE,EAAE,OAAO,EAAE;QACtD,IAAI,CAAC,MAAM,OAAO,CAAC,UAAU,MAAM,MAAM,KAAK,GAAG;QACjD,IAAI,CAAC,SAAS,MAAM,IAAI,mBAAmB;QAE3C,sCAAsC;QACtC,KAAK,MAAM,MAAM,MAAO;YACtB,GAAG,SAAS,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,SAAS;YAChD,IAAI,CAAC,eAAe,CAAC,GAAG,SAAS,EAAE,GAAG,SAAS,EAAE,GAAG,GAAG;QACzD;QAEA,mFAAmF;QACnF,KAAK,MAAM,MAAM,MAAO;YACtB,MAAM,UAAU,MAAM,iIAAO,CAAC,SAAS,CACrC;gBACE,KAAK,GAAG,SAAS;gBACjB,eAAe,GAAG,SAAS;gBAC3B,eAAe;oBAAE,MAAM,GAAG,GAAG;gBAAC;YAChC,GACA;gBAAE,MAAM;oBAAE,qBAAqB,CAAC,GAAG,GAAG;gBAAC;YAAE,GACzC;gBAAE,cAAc;oBAAC;wBAAE,YAAY,GAAG,SAAS;oBAAC;iBAAE;gBAAE;YAAQ;YAG1D,MAAM,WAAW,CAAC,QAAQ,aAAa,IAAI,QAAQ,SAAS,IAAI,CAAC,IAAI;YACrE,IAAI,CAAC,UAAU;gBACb,MAAM,UAAU,MAAM,iIAAO,CAAC,OAAO,CACnC;oBAAE,KAAK,GAAG,SAAS;oBAAE,eAAe,GAAG,SAAS;gBAAC,GACjD;oBAAE,WAAW;gBAAE,GACf,OAAO,CAAC,SAAS,IAAI;gBAEvB,MAAM,YAAY,WAAW,QAAQ,KAAK,IAAI,QAAQ,KAAK,CAAC,EAAE,GAAG,OAAO,QAAQ,KAAK,CAAC,EAAE,CAAC,KAAK,IAAI,KAAK;gBACvG,MAAM,IAAI,uBACR,CAAC,+BAA+B,EAAE,GAAG,SAAS,CAAC,MAAM,EAAE,GAAG,SAAS,CAAC,YAAY,EAAE,GAAG,GAAG,CAAC,YAAY,EAAE,WAAW;YAEtH;QACF;IACA,+DAA+D;IACjE;AACF","debugId":null}},
    {"offset": {"line": 398, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder/src/pages/api/inventory/adjust.js"],"sourcesContent":["// src/pages/api/inventory/adjust.js\nimport dbConnect from \"lib/dbConnect.js\";\nimport InventoryService from \"services/inventory.js\";\n\n/**\n * POST /api/inventory/adjust\n * Body:\n * { productId: \"id\", sizeLabel: \"M\", qty: 5, operation: \"increase\"|\"decrease\"|\"set\" }\n *\n * Admin-only endpoint (add auth in real app).\n */\nexport default async function handler(req, res) {\n  try { await dbConnect(); } catch (err) {\n    console.error(\"DB connect failed:\", err);\n    return res.status(500).json({ error: \"Database connection failed\" });\n  }\n\n  if (req.method !== \"POST\") {\n    res.setHeader(\"Allow\", [\"POST\"]);\n    return res.status(405).end(`Method ${req.method} Not Allowed`);\n  }\n\n  try {\n    const { productId, sizeLabel, qty, operation = \"increase\" } = req.body || {};\n    if (!productId || !sizeLabel) return res.status(400).json({ error: \"productId and sizeLabel are required\" });\n    const nQty = Number(qty || 0);\n    if (!Number.isFinite(nQty)) return res.status(400).json({ error: \"qty must be a number\" });\n\n    // Choose operation\n    if (operation === \"increase\") {\n      const ok = await InventoryService.increaseStock(productId, sizeLabel, nQty);\n      if (!ok) {\n        // size missing â€” create\n        await InventoryService.addOrCreateSize(productId, sizeLabel, nQty);\n      }\n      return res.status(200).json({ success: true });\n    }\n\n    if (operation === \"decrease\") {\n      const ok = await InventoryService.decreaseStock(productId, sizeLabel, nQty);\n      if (!ok) return res.status(409).json({ error: \"Insufficient stock or size not found\" });\n      return res.status(200).json({ success: true });\n    }\n\n    if (operation === \"set\") {\n      // set exact stock value for size (create if missing)\n      await InventoryService.addOrCreateSize(productId, sizeLabel, nQty);\n      return res.status(200).json({ success: true });\n    }\n\n    return res.status(400).json({ error: \"invalid operation\" });\n  } catch (err) {\n    console.error(\"POST /api/inventory/adjust error:\", err);\n    return res.status(500).json({ error: err.message || \"Inventory adjust failed\" });\n  }\n}\n"],"names":[],"mappings":"AAAA,oCAAoC;;;;;AACpC;AACA;;;AASe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI;QAAE,MAAM,IAAA,2HAAS;IAAI,EAAE,OAAO,KAAK;QACrC,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA6B;IACpE;IAEA,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,IAAI,SAAS,CAAC,SAAS;YAAC;SAAO;QAC/B,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,IAAI,MAAM,CAAC,YAAY,CAAC;IAC/D;IAEA,IAAI;QACF,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,EAAE,YAAY,UAAU,EAAE,GAAG,IAAI,IAAI,IAAI,CAAC;QAC3E,IAAI,CAAC,aAAa,CAAC,WAAW,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAuC;QAC1G,MAAM,OAAO,OAAO,OAAO;QAC3B,IAAI,CAAC,OAAO,QAAQ,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAuB;QAExF,mBAAmB;QACnB,IAAI,cAAc,YAAY;YAC5B,MAAM,KAAK,MAAM,gIAAgB,CAAC,aAAa,CAAC,WAAW,WAAW;YACtE,IAAI,CAAC,IAAI;gBACP,wBAAwB;gBACxB,MAAM,gIAAgB,CAAC,eAAe,CAAC,WAAW,WAAW;YAC/D;YACA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC9C;QAEA,IAAI,cAAc,YAAY;YAC5B,MAAM,KAAK,MAAM,gIAAgB,CAAC,aAAa,CAAC,WAAW,WAAW;YACtE,IAAI,CAAC,IAAI,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAuC;YACrF,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC9C;QAEA,IAAI,cAAc,OAAO;YACvB,qDAAqD;YACrD,MAAM,gIAAgB,CAAC,eAAe,CAAC,WAAW,WAAW;YAC7D,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC9C;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAoB;IAC3D,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO,IAAI;QAA0B;IAChF;AACF","debugId":null}}]
}