{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/SEM-3/OOPS/Project%20OOPS/Project%20OOPS/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/SEM-3/OOPS/Project%20OOPS/Project%20OOPS/src/models/User.js"],"sourcesContent":["// src/models/User.js\nimport mongoose from \"mongoose\";\n\nconst userSchema = new mongoose.Schema({\n  name: { type: String },\n  email: { type: String, index: true, sparse: true, unique: false },\n  phone: { type: String, index: true, sparse: true, unique: false },\n  password: { type: String }, // hashed password (bcrypt)\n  oauthProvider: String,\n  oauthId: String,\n  role: { type: String, enum: [\"CUSTOMER\",\"RETAILER\",\"WHOLESALER\"], default: \"CUSTOMER\" },\n  verified: { type: Boolean, default: false },\n  otp: {\n    code: String,\n    expiresAt: Date\n  }\n}, { timestamps: true });\n\nexport default mongoose.models.User || mongoose.model(\"User\", userSchema);\n"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AACrB;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,MAAM;QAAE,MAAM;IAAO;IACrB,OAAO;QAAE,MAAM;QAAQ,OAAO;QAAM,QAAQ;QAAM,QAAQ;IAAM;IAChE,OAAO;QAAE,MAAM;QAAQ,OAAO;QAAM,QAAQ;QAAM,QAAQ;IAAM;IAChE,UAAU;QAAE,MAAM;IAAO;IACzB,eAAe;IACf,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAW;YAAW;SAAa;QAAE,SAAS;IAAW;IACtF,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,KAAK;QACH,MAAM;QACN,WAAW;IACb;AACF,GAAG;IAAE,YAAY;AAAK;uCAEP,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ","debugId":null}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///C:/SEM-3/OOPS/Project%20OOPS/Project%20OOPS/src/pages/api/auth/set-password.js"],"sourcesContent":["// src/pages/api/auth/set-password.js\nimport dbConnect from \"../../../lib/dbConnect\";\nimport User from \"../../../models/User\";\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\n\nexport default async function handler(req, res) {\n  await dbConnect();\n\n  if (req.method !== \"POST\") return res.status(405).json({ ok: false, message: \"Method not allowed\" });\n\n  const auth = req.headers.authorization || \"\";\n  const token = auth.startsWith(\"Bearer \") ? auth.slice(7) : null;\n  if (!token) return res.status(401).json({ ok: false, message: \"Missing token\" });\n\n  const secret = process.env.JWT_SECRET;\n  if (!secret) return res.status(500).json({ ok: false, message: \"Server misconfigured\" });\n\n  let payload;\n  try {\n    payload = jwt.verify(token, secret);\n  } catch (err) {\n    return res.status(401).json({ ok: false, message: \"Invalid or expired token\" });\n  }\n\n  const { password } = req.body || {};\n  if (!password || password.length < 6) {\n    return res.status(400).json({ ok: false, message: \"Password is required (min 6 chars)\" });\n  }\n\n  const user = await User.findById(payload.id);\n  if (!user) return res.status(404).json({ ok: false, message: \"User not found\" });\n\n  // Hash & set password, mark verified (already true from OTP verify, but ensure)\n  const hashed = await bcrypt.hash(password, 10);\n  user.password = hashed;\n  user.verified = true;\n  await user.save();\n\n  return res.json({ ok: true, message: \"Password set\" });\n}\n"],"names":[],"mappings":"AAAA,qCAAqC;;;;;AACrC;AACA;AACA;AACA;;;;;;;;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,IAAA,2HAAS;IAEf,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAAqB;IAElG,MAAM,OAAO,IAAI,OAAO,CAAC,aAAa,IAAI;IAC1C,MAAM,QAAQ,KAAK,UAAU,CAAC,aAAa,KAAK,KAAK,CAAC,KAAK;IAC3D,IAAI,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAAgB;IAE9E,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;IACrC,IAAI,CAAC,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAAuB;IAEtF,IAAI;IACJ,IAAI;QACF,UAAU,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC9B,EAAE,OAAO,KAAK;QACZ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS;QAA2B;IAC/E;IAEA,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI,IAAI,CAAC;IAClC,IAAI,CAAC,YAAY,SAAS,MAAM,GAAG,GAAG;QACpC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS;QAAqC;IACzF;IAEA,MAAM,OAAO,MAAM,yHAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;IAC3C,IAAI,CAAC,MAAM,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAAiB;IAE9E,gFAAgF;IAChF,MAAM,SAAS,MAAM,2HAAM,CAAC,IAAI,CAAC,UAAU;IAC3C,KAAK,QAAQ,GAAG;IAChB,KAAK,QAAQ,GAAG;IAChB,MAAM,KAAK,IAAI;IAEf,OAAO,IAAI,IAAI,CAAC;QAAE,IAAI;QAAM,SAAS;IAAe;AACtD","debugId":null}}]
}