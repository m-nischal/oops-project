{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/SEM-3/OOPS/Project%20OOPS/Project%20OOPS/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/SEM-3/OOPS/Project%20OOPS/Project%20OOPS/src/models/User.js"],"sourcesContent":["// src/models/User.js\nimport mongoose from \"mongoose\";\n\nconst userSchema = new mongoose.Schema({\n  name: { type: String },\n  email: { type: String, index: true, sparse: true, unique: false },\n  phone: { type: String, index: true, sparse: true, unique: false },\n  password: { type: String }, // hashed password (bcrypt)\n  oauthProvider: String,\n  oauthId: String,\n  role: { type: String, enum: [\"CUSTOMER\",\"RETAILER\",\"WHOLESALER\"], default: \"CUSTOMER\" },\n  verified: { type: Boolean, default: false },\n  otp: {\n    code: String,\n    expiresAt: Date\n  }\n}, { timestamps: true });\n\nexport default mongoose.models.User || mongoose.model(\"User\", userSchema);\n"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AACrB;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,MAAM;QAAE,MAAM;IAAO;IACrB,OAAO;QAAE,MAAM;QAAQ,OAAO;QAAM,QAAQ;QAAM,QAAQ;IAAM;IAChE,OAAO;QAAE,MAAM;QAAQ,OAAO;QAAM,QAAQ;QAAM,QAAQ;IAAM;IAChE,UAAU;QAAE,MAAM;IAAO;IACzB,eAAe;IACf,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAW;YAAW;SAAa;QAAE,SAAS;IAAW;IACtF,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,KAAK;QACH,MAAM;QACN,WAAW;IACb;AACF,GAAG;IAAE,YAAY;AAAK;uCAEP,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ","debugId":null}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///C:/SEM-3/OOPS/Project%20OOPS/Project%20OOPS/src/lib/otpSenders.js"],"sourcesContent":["// lib/otpSenders.js\nimport nodemailer from \"nodemailer\";\n\nexport async function sendSmsOTP(phone, code) {\n  // For local/dev: mock console log\n  console.log(`Send SMS to ${phone}: OTP ${code}`);\n  return true;\n}\n\nexport async function sendEmailOTP(email, code) {\n  if (!process.env.SMTP_HOST) {\n    console.log(`Mock email to ${email}: OTP ${code}`);\n    return true;\n  }\n  const transporter = nodemailer.createTransport({\n    host: process.env.SMTP_HOST,\n    port: Number(process.env.SMTP_PORT || 587),\n    secure: Boolean(process.env.SMTP_SECURE === \"true\"),\n    auth: {\n      user: process.env.SMTP_USER,\n      pass: process.env.SMTP_PASS\n    }\n  });\n  await transporter.sendMail({\n    from: process.env.SMTP_FROM || \"no-reply@example.com\",\n    to: email,\n    subject: \"Your LiveMart OTP\",\n    text: `Your OTP: ${code}. It will expire in 5 minutes.`\n  });\n  return true;\n}\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;;;AACpB;;AAEO,eAAe,WAAW,KAAK,EAAE,IAAI;IAC1C,kCAAkC;IAClC,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,MAAM,MAAM,EAAE,MAAM;IAC/C,OAAO;AACT;AAEO,eAAe,aAAa,KAAK,EAAE,IAAI;IAC5C,IAAI,CAAC,QAAQ,GAAG,CAAC,SAAS,EAAE;QAC1B,QAAQ,GAAG,CAAC,CAAC,cAAc,EAAE,MAAM,MAAM,EAAE,MAAM;QACjD,OAAO;IACT;IACA,MAAM,cAAc,wHAAU,CAAC,eAAe,CAAC;QAC7C,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC3B,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS,IAAI;QACtC,QAAQ,QAAQ,QAAQ,GAAG,CAAC,WAAW,KAAK;QAC5C,MAAM;YACJ,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC7B;IACF;IACA,MAAM,YAAY,QAAQ,CAAC;QACzB,MAAM,QAAQ,GAAG,CAAC,SAAS,IAAI;QAC/B,IAAI;QACJ,SAAS;QACT,MAAM,CAAC,UAAU,EAAE,KAAK,8BAA8B,CAAC;IACzD;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///C:/SEM-3/OOPS/Project%20OOPS/Project%20OOPS/src/pages/api/auth/otp/request.js"],"sourcesContent":["// pages/api/auth/otp/request.js\nimport dbConnect from \"../../../../lib/dbConnect\";\nimport User from \"../../../../models/User\";\nimport { sendSmsOTP, sendEmailOTP } from \"../../../../lib/otpSenders\";\n // implementations below\nimport crypto from \"crypto\";\n\nexport default async function handler(req, res) {\n  await dbConnect();\n  if (req.method !== \"POST\") return res.status(405).end();\n\n  const { phone, email, role = \"CUSTOMER\", name } = req.body;\n  if (!phone && !email) return res.status(400).json({ ok: false, message: \"phone or email required\" });\n\n  // generate code\n  const code = (Math.floor(100000 + Math.random() * 900000)).toString();\n  const expiresAt = new Date(Date.now() + 5 * 60 * 1000); // 5 min\n\n  // find or create user (set role if new)\n  const query = phone ? { phone } : { email };\n  let user = await User.findOne(query);\n  if (!user) {\n    user = await User.create({\n      name,\n      phone: phone || undefined,\n      email: email || undefined,\n      role,\n      verified: false,\n      otp: { code, expiresAt }\n    });\n  } else {\n    // update otp and ensure role kept or set if missing\n    user.otp = { code, expiresAt };\n    if (!user.role) user.role = role;\n    await user.save();\n  }\n\n  try {\n    if (phone) {\n      await sendSmsOTP(phone, code);\n    } else {\n      await sendEmailOTP(email, code);\n    }\n    return res.json({ ok: true, message: \"OTP sent (mock)\", debugCode: code });\n  } catch (err) {\n    console.error(err);\n    return res.status(500).json({ ok: false, message: \"Failed to send OTP\" });\n  }\n}\n"],"names":[],"mappings":"AAAA,gCAAgC;;;;;AAChC;AACA;AACA;AACC,wBAAwB;AACzB;;;;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,IAAA,2HAAS;IACf,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;IAErD,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,UAAU,EAAE,IAAI,EAAE,GAAG,IAAI,IAAI;IAC1D,IAAI,CAAC,SAAS,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAA0B;IAElG,gBAAgB;IAChB,MAAM,OAAO,AAAC,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAS,QAAQ;IACnE,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,OAAO,QAAQ;IAEhE,wCAAwC;IACxC,MAAM,QAAQ,QAAQ;QAAE;IAAM,IAAI;QAAE;IAAM;IAC1C,IAAI,OAAO,MAAM,yHAAI,CAAC,OAAO,CAAC;IAC9B,IAAI,CAAC,MAAM;QACT,OAAO,MAAM,yHAAI,CAAC,MAAM,CAAC;YACvB;YACA,OAAO,SAAS;YAChB,OAAO,SAAS;YAChB;YACA,UAAU;YACV,KAAK;gBAAE;gBAAM;YAAU;QACzB;IACF,OAAO;QACL,oDAAoD;QACpD,KAAK,GAAG,GAAG;YAAE;YAAM;QAAU;QAC7B,IAAI,CAAC,KAAK,IAAI,EAAE,KAAK,IAAI,GAAG;QAC5B,MAAM,KAAK,IAAI;IACjB;IAEA,IAAI;QACF,IAAI,OAAO;YACT,MAAM,IAAA,+HAAU,EAAC,OAAO;QAC1B,OAAO;YACL,MAAM,IAAA,iIAAY,EAAC,OAAO;QAC5B;QACA,OAAO,IAAI,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;YAAmB,WAAW;QAAK;IAC1E,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS;QAAqB;IACzE;AACF","debugId":null}}]
}