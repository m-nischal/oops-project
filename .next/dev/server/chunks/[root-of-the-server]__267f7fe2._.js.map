{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/pages/api/auth/otp/request.js"],"sourcesContent":["// pages/api/auth/login.js\nimport dbConnect from \"../../../lib/dbConnect\";\nimport User from \"../../../models/User\";\nimport bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev_jwt_secret\";\nconst JWT_EXPIRES_IN = process.env.JWT_EXPIRES_IN || \"7d\";\n\nfunction signToken(user) {\n  return jwt.sign({ id: String(user._id), role: user.role || \"CUSTOMER\", email: user.email }, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN });\n}\n\nexport default async function handler(req, res) {\n  await dbConnect();\n  if (req.method !== \"POST\") return res.status(405).json({ ok: false, message: \"Method not allowed\" });\n\n  const { email, password } = req.body;\n  if (!email || !password) return res.status(400).json({ ok: false, message: \"Email and password required\" });\n\n  const normalizedEmail = String(email).toLowerCase().trim();\n  try {\n    const user = await User.findOne({ email: normalizedEmail }).select(\"+password\"); // ensure password field is selected if schema marks select:false\n    if (!user) {\n      return res.status(401).json({ ok: false, message: \"Invalid credentials\" });\n    }\n\n    // If password stored as undefined/empty, reject\n    if (!user.password) {\n      return res.status(401).json({ ok: false, message: \"No password set for this account. Please use OTP login.\" });\n    }\n\n    const passwordMatches = await bcrypt.compare(password, user.password);\n    if (!passwordMatches) {\n      return res.status(401).json({ ok: false, message: \"Invalid credentials\" });\n    }\n\n    const token = signToken(user);\n    return res.status(200).json({ ok: true, token, user: { id: user._id, email: user.email, role: user.role } });\n  } catch (err) {\n    console.error(\"Login error:\", err);\n    return res.status(500).json({ ok: false, message: \"Server error during login\" });\n  }\n}\n"],"names":[],"mappings":"AAAA,0BAA0B;;;;;;;;;;;;;;;AAG1B;AACA;;;;;;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI;AAErD,SAAS,UAAU,IAAI;IACrB,OAAO,4HAAG,CAAC,IAAI,CAAC;QAAE,IAAI,OAAO,KAAK,GAAG;QAAG,MAAM,KAAK,IAAI,IAAI;QAAY,OAAO,KAAK,KAAK;IAAC,GAAG,YAAY;QAAE,WAAW;IAAe;AACtI;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM;IACN,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAAqB;IAElG,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IACpC,IAAI,CAAC,SAAS,CAAC,UAAU,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAA8B;IAEzG,MAAM,kBAAkB,OAAO,OAAO,WAAW,GAAG,IAAI;IACxD,IAAI;QACF,MAAM,OAAO,MAAM,KAAK,OAAO,CAAC;YAAE,OAAO;QAAgB,GAAG,MAAM,CAAC,cAAc,iEAAiE;QAClJ,IAAI,CAAC,MAAM;YACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,IAAI;gBAAO,SAAS;YAAsB;QAC1E;QAEA,gDAAgD;QAChD,IAAI,CAAC,KAAK,QAAQ,EAAE;YAClB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,IAAI;gBAAO,SAAS;YAA0D;QAC9G;QAEA,MAAM,kBAAkB,MAAM,2HAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;QACpE,IAAI,CAAC,iBAAiB;YACpB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,IAAI;gBAAO,SAAS;YAAsB;QAC1E;QAEA,MAAM,QAAQ,UAAU;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAM;YAAO,MAAM;gBAAE,IAAI,KAAK,GAAG;gBAAE,OAAO,KAAK,KAAK;gBAAE,MAAM,KAAK,IAAI;YAAC;QAAE;IAC5G,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS;QAA4B;IAChF;AACF","debugId":null}}]
}