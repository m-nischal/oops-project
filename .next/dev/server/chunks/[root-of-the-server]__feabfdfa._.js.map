{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder/src/pages/api/products/index.js"],"sourcesContent":["// src/pages/api/products/index.js\nimport mongoose from \"mongoose\";\nimport dotenv from \"dotenv\";\nimport Product from \"../../../../models/productModel.js\";\nimport Category from \"../../../../models/categoryModel.js\";\ndotenv.config();\n\nasync function getDescendantCategoryIds(categoryId) {\n  const cat = await Category.findById(categoryId);\n  if (!cat) return [];\n  const regex = new RegExp(`^${cat.path}(/|$)`);\n  const desc = await Category.find({ path: { $regex: regex } }, { _id: 1 });\n  return desc.map(c => c._id);\n}\n\nexport default async function handler(req, res) {\n  if (!mongoose.connection.readyState)\n    await mongoose.connect(process.env.MONGO_URI);\n\n  if (req.method === \"GET\") {\n    const { categoryId, limit = 20, page = 1, q = \"\", inStockOnly, storefront } = req.query;\n    const filter = {};\n\n    if (categoryId) {\n      const ids = await getDescendantCategoryIds(categoryId);\n      filter.categories = { $in: ids };\n    }\n    if (storefront) filter.storefronts = storefront;\n    if (inStockOnly === \"true\") filter[\"sizes.stock\"] = { $gt: 0 };\n    if (q) filter.$text = { $search: q };\n\n    const skip = (Number(page) - 1) * Number(limit);\n    const docs = await Product.find(filter).skip(skip).limit(Number(limit)).lean();\n    const total = await Product.countDocuments(filter);\n\n    return res.status(200).json({ items: docs, total });\n  }\n\n  res.status(405).json({ message: \"Method not allowed\" });\n}\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAClC;AACA;;;;;;;;;;;;;;;AAGA,gHAAM,CAAC,MAAM;AAEb,eAAe,yBAAyB,UAAU;IAChD,MAAM,MAAM,MAAM,SAAS,QAAQ,CAAC;IACpC,IAAI,CAAC,KAAK,OAAO,EAAE;IACnB,MAAM,QAAQ,IAAI,OAAO,CAAC,CAAC,EAAE,IAAI,IAAI,CAAC,KAAK,CAAC;IAC5C,MAAM,OAAO,MAAM,SAAS,IAAI,CAAC;QAAE,MAAM;YAAE,QAAQ;QAAM;IAAE,GAAG;QAAE,KAAK;IAAE;IACvE,OAAO,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,GAAG;AAC5B;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,CAAC,oHAAQ,CAAC,UAAU,CAAC,UAAU,EACjC,MAAM,oHAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,SAAS;IAE9C,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,EAAE,OAAO,CAAC,EAAE,IAAI,EAAE,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,IAAI,KAAK;QACvF,MAAM,SAAS,CAAC;QAEhB,IAAI,YAAY;YACd,MAAM,MAAM,MAAM,yBAAyB;YAC3C,OAAO,UAAU,GAAG;gBAAE,KAAK;YAAI;QACjC;QACA,IAAI,YAAY,OAAO,WAAW,GAAG;QACrC,IAAI,gBAAgB,QAAQ,MAAM,CAAC,cAAc,GAAG;YAAE,KAAK;QAAE;QAC7D,IAAI,GAAG,OAAO,KAAK,GAAG;YAAE,SAAS;QAAE;QAEnC,MAAM,OAAO,CAAC,OAAO,QAAQ,CAAC,IAAI,OAAO;QACzC,MAAM,OAAO,MAAM,QAAQ,IAAI,CAAC,QAAQ,IAAI,CAAC,MAAM,KAAK,CAAC,OAAO,QAAQ,IAAI;QAC5E,MAAM,QAAQ,MAAM,QAAQ,cAAc,CAAC;QAE3C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;YAAM;QAAM;IACnD;IAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,SAAS;IAAqB;AACvD","debugId":null}}]
}