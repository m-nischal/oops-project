{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/models/User.js"],"sourcesContent":["// src/models/User.js\nimport mongoose from \"mongoose\";\n\nconst userSchema = new mongoose.Schema({\n  name: { type: String },\n  email: { type: String, index: true, sparse: true, unique: true },\n  password: { type: String, select: false },\n  oauthProvider: String,\n  oauthId: String,\n  role: { type: String, enum: [\"CUSTOMER\",\"RETAILER\",\"WHOLESALER\"], default: \"CUSTOMER\" },\n  verified: { type: Boolean, default: false },\n  otp: {\n    code: String,\n    expiresAt: Date\n  },\n  resetOtp: { type: String },\n  resetOtpExpiry: { type: Number },\n  resetAttempts: { type: Number }\n}, { timestamps: true });\n\nexport default mongoose.models.User || mongoose.model(\"User\", userSchema);\n"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AACrB;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,MAAM;QAAE,MAAM;IAAO;IACrB,OAAO;QAAE,MAAM;QAAQ,OAAO;QAAM,QAAQ;QAAM,QAAQ;IAAK;IAC/D,UAAU;QAAE,MAAM;QAAQ,QAAQ;IAAM;IACxC,eAAe;IACf,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAW;YAAW;SAAa;QAAE,SAAS;IAAW;IACtF,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,KAAK;QACH,MAAM;QACN,WAAW;IACb;IACA,UAAU;QAAE,MAAM;IAAO;IACzB,gBAAgB;QAAE,MAAM;IAAO;IAC/B,eAAe;QAAE,MAAM;IAAO;AAChC,GAAG;IAAE,YAAY;AAAK;uCAEP,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ","debugId":null}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/lib/emailTemplates.js"],"sourcesContent":["// lib/emailTemplates.js\r\nexport function otpEmailHtml({ appName = \"LiveMart\", otp, expiryMinutes = 10 }) {\r\n  return `\r\n  <div style=\"font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7;\">\r\n    <div style=\"max-width: 600px; margin: auto; background: #ffffff; padding: 24px; border-radius: 8px;\">\r\n      <h2 style=\"color: #222; margin-bottom: 6px;\">${appName} — Verification Code</h2>\r\n      <p style=\"color: #555; margin-top: 0;\">\r\n        Use the code below to verify your email address. The code expires in ${expiryMinutes} minutes.\r\n      </p>\r\n\r\n      <div style=\"margin: 22px 0; text-align: center;\">\r\n        <div style=\"display:inline-block; padding: 14px 22px; border-radius:8px; background:#f0f4ff;\">\r\n          <span style=\"font-size: 28px; font-weight: 700; letter-spacing: 6px; color: #1a56db;\">\r\n            ${otp}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <p style=\"color:#777; font-size:14px;\">\r\n        If you didn’t request this, you can safely ignore this email.\r\n      </p>\r\n\r\n      <p style=\"color:#999; font-size:13px; margin-top:18px;\">\r\n        — ${appName} Team\r\n      </p>\r\n    </div>\r\n  </div>\r\n  `;\r\n}\r\n\r\nexport function resetPasswordEmailHtml({ appName = \"LiveMart\", otp, expiryMinutes = 10 }) {\r\n  return `\r\n  <div style=\"font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7;\">\r\n    <div style=\"max-width: 600px; margin: auto; background: #ffffff; padding: 24px; border-radius: 8px;\">\r\n      <h2 style=\"color:#222; margin-bottom:6px;\">${appName} — Password Reset</h2>\r\n      <p style=\"color:#555; margin-top:0;\">\r\n        We received a request to reset the password for your account. Use the code below to continue.\r\n      </p>\r\n\r\n      <div style=\"margin:22px 0; text-align:center;\">\r\n        <div style=\"display:inline-block; padding:14px 22px; border-radius:8px; background:#fff0f0;\">\r\n          <span style=\"font-size:28px; font-weight:700; letter-spacing:6px; color:#d5182a;\">\r\n            ${otp}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <p style=\"color:#777; font-size:14px;\">\r\n        This code is valid for ${expiryMinutes} minutes. If you did not request a password reset, ignore this message.\r\n      </p>\r\n\r\n      <p style=\"color:#999; font-size:13px; margin-top:18px;\">\r\n        — ${appName} Team\r\n      </p>\r\n    </div>\r\n  </div>\r\n  `;\r\n}\r\n"],"names":[],"mappings":"AAAA,wBAAwB;;;;;;;AACjB,SAAS,aAAa,EAAE,UAAU,UAAU,EAAE,GAAG,EAAE,gBAAgB,EAAE,EAAE;IAC5E,OAAO,CAAC;;;mDAGyC,EAAE,QAAQ;;6EAEgB,EAAE,cAAc;;;;;;YAMjF,EAAE,IAAI;;;;;;;;;;UAUR,EAAE,QAAQ;;;;EAIlB,CAAC;AACH;AAEO,SAAS,uBAAuB,EAAE,UAAU,UAAU,EAAE,GAAG,EAAE,gBAAgB,EAAE,EAAE;IACtF,OAAO,CAAC;;;iDAGuC,EAAE,QAAQ;;;;;;;;YAQ/C,EAAE,IAAI;;;;;;+BAMa,EAAE,cAAc;;;;UAIrC,EAAE,QAAQ;;;;EAIlB,CAAC;AACH","debugId":null}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/pages/api/auth/otp/request.js"],"sourcesContent":["// pages/api/auth/otp/request.js\nimport dbConnect from \"../../../../lib/dbConnect\";\nimport User from \"../../../../models/User\";\nimport bcrypt from \"bcryptjs\";\nimport nodemailer from \"nodemailer\";\nimport { otpEmailHtml } from \"../../../../lib/emailTemplates\";\n\nconst OTP_TTL_MS = 10 * 60 * 1000;\n\nexport default async function handler(req, res) {\n  await dbConnect();\n  if (req.method !== \"POST\") return res.status(405).json({ ok: false, message: \"Method not allowed\" });\n\n  const { email, role } = req.body || {};\n  if (!email) return res.status(400).json({ ok: false, message: \"Email required\" });\n\n  try {\n    // generate 6-digit OTP\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\n\n    // hash for storage\n    const hash = await bcrypt.hash(otp, 10);\n\n    // find or create user\n    let user = await User.findOne({ email: String(email).toLowerCase() });\n    if (!user) {\n      user = new User({ email: String(email).toLowerCase(), role: role || \"CUSTOMER\" });\n    }\n\n    user.otp = { code: hash, expiresAt: new Date(Date.now() + OTP_TTL_MS) };\n    await user.save();\n\n    // send email — adjust transporter to your SMTP envs\n    const transporter = nodemailer.createTransport({\n      host: process.env.SMTP_HOST,\n      port: Number(process.env.SMTP_PORT || 587),\n      secure: String(process.env.SMTP_PORT) === \"465\",\n      auth: { user: process.env.SMTP_USER, pass: process.env.SMTP_PASS }\n    });\n\n        // Subject + html\n    const subject = \"Your LiveMart verification code\";\n    const html = otpEmailHtml({ otp, expiryMinutes: 10, appName: \"LiveMart\" });\n\n    // send\n    await transporter.sendMail({\n      from: process.env.FROM_EMAIL || process.env.SMTP_USER,\n      to: user.email,\n      subject,\n      html,\n      // optionally include text fallback\n      text: `Your LiveMart verification code is ${otp}. It expires in 10 minutes.`\n    });\n    \n    return res.status(200).json({ ok: true, message: \"OTP sent\" });\n  } catch (err) {\n    console.error(\"OTP request error:\", err);\n    return res.status(500).json({ ok: false, message: \"Server error\" });\n  }\n}\n"],"names":[],"mappings":"AAAA,gCAAgC;;;;;AAChC;AACA;AACA;AACA;AACA;;;;;;;;;;AAEA,MAAM,aAAa,KAAK,KAAK;AAEd,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,IAAA,4IAAS;IACf,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAAqB;IAElG,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,IAAI,IAAI,IAAI,CAAC;IACrC,IAAI,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAAiB;IAE/E,IAAI;QACF,uBAAuB;QACvB,MAAM,MAAM,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;QAEhE,mBAAmB;QACnB,MAAM,OAAO,MAAM,2HAAM,CAAC,IAAI,CAAC,KAAK;QAEpC,sBAAsB;QACtB,IAAI,OAAO,MAAM,0IAAI,CAAC,OAAO,CAAC;YAAE,OAAO,OAAO,OAAO,WAAW;QAAG;QACnE,IAAI,CAAC,MAAM;YACT,OAAO,IAAI,0IAAI,CAAC;gBAAE,OAAO,OAAO,OAAO,WAAW;gBAAI,MAAM,QAAQ;YAAW;QACjF;QAEA,KAAK,GAAG,GAAG;YAAE,MAAM;YAAM,WAAW,IAAI,KAAK,KAAK,GAAG,KAAK;QAAY;QACtE,MAAM,KAAK,IAAI;QAEf,oDAAoD;QACpD,MAAM,cAAc,wHAAU,CAAC,eAAe,CAAC;YAC7C,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS,IAAI;YACtC,QAAQ,OAAO,QAAQ,GAAG,CAAC,SAAS,MAAM;YAC1C,MAAM;gBAAE,MAAM,QAAQ,GAAG,CAAC,SAAS;gBAAE,MAAM,QAAQ,GAAG,CAAC,SAAS;YAAC;QACnE;QAEI,iBAAiB;QACrB,MAAM,UAAU;QAChB,MAAM,OAAO,IAAA,sJAAY,EAAC;YAAE;YAAK,eAAe;YAAI,SAAS;QAAW;QAExE,OAAO;QACP,MAAM,YAAY,QAAQ,CAAC;YACzB,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI,QAAQ,GAAG,CAAC,SAAS;YACrD,IAAI,KAAK,KAAK;YACd;YACA;YACA,mCAAmC;YACnC,MAAM,CAAC,mCAAmC,EAAE,IAAI,2BAA2B,CAAC;QAC9E;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;QAAW;IAC9D,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS;QAAe;IACnE;AACF","debugId":null}}]
}