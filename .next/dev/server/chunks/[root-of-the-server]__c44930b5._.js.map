{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/Project%20OOPS%202/src/pages/api/upload.js"],"sourcesContent":["// src/pages/api/upload.js\r\nimport multer from 'multer';\r\nimport path from 'path';\r\n\r\n// --- Helper to run middleware ---\r\n// This allows us to use multer (which is Express/Connect middleware)\r\n// in a standard Next.js API route.\r\nfunction runMiddleware(req, res, fn) {\r\n  return new Promise((resolve, reject) => {\r\n    fn(req, res, (result) => {\r\n      if (result instanceof Error) {\r\n        return reject(result);\r\n      }\r\n      return resolve(result);\r\n    });\r\n  });\r\n}\r\n\r\n// --- Configuration for Multer (same as before) ---\r\nconst storage = multer.diskStorage({\r\n  destination: './public/uploads', //\r\n  filename: (req, file, cb) => {\r\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\r\n    const extension = path.extname(file.originalname);\r\n    cb(null, file.fieldname + '-' + uniqueSuffix + extension);\r\n  },\r\n});\r\n\r\nconst fileFilter = (req, file, cb) => {\r\n  if (file.mimetype.startsWith('image/')) {\r\n    cb(null, true);\r\n  } else {\r\n    cb(new Error('Only image files are allowed!'), false);\r\n  }\r\n};\r\n\r\n// We re-use the same multer instance\r\nconst upload = multer({ \r\n  storage: storage,\r\n  fileFilter: fileFilter,\r\n  limits: { fileSize: 5 * 1024 * 1024 }\r\n});\r\n\r\n// --- API Route Handler ---\r\nexport const config = {\r\n  api: {\r\n    bodyParser: false, // Disable body parser, multer handles it\r\n  },\r\n};\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method !== 'POST') {\r\n    res.setHeader('Allow', ['POST']);\r\n    return res.status(405).end(`Method ${req.method} Not Allowed`);\r\n  }\r\n\r\n  try {\r\n    // Run the multer middleware for our fields\r\n    await runMiddleware(req, res, upload.fields([\r\n      { name: 'productImages', maxCount: 10 },\r\n      { name: 'productImage', maxCount: 1 }\r\n    ]));\r\n    \r\n    // After middleware, req.files will be populated\r\n    if (!req.files || (Object.keys(req.files).length === 0)) {\r\n      return res.status(400).json({ error: 'No files were uploaded.' });\r\n    }\r\n\r\n    // Process the files and get URLs\r\n    const urls = {};\r\n    if (req.files.productImages) {\r\n      urls.productImages = req.files.productImages.map(file => `/uploads/${file.filename}`);\r\n    }\r\n    if (req.files.productImage) {\r\n      urls.productImage = req.files.productImage.map(file => `/uploads/${file.filename}`);\r\n    }\r\n    \r\n    return res.status(200).json({ \r\n      message: 'Files uploaded successfully', \r\n      urls: urls // Return an object with both field arrays\r\n    });\r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    return res.status(500).json({ error: err.message || 'Something went wrong!' });\r\n  }\r\n}"],"names":[],"mappings":"AAAA,0BAA0B;;;;;;;AAC1B;AACA;;;AAEA,mCAAmC;AACnC,qEAAqE;AACrE,mCAAmC;AACnC,SAAS,cAAc,GAAG,EAAE,GAAG,EAAE,EAAE;IACjC,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,GAAG,KAAK,KAAK,CAAC;YACZ,IAAI,kBAAkB,OAAO;gBAC3B,OAAO,OAAO;YAChB;YACA,OAAO,QAAQ;QACjB;IACF;AACF;AAEA,oDAAoD;AACpD,MAAM,UAAU,gHAAM,CAAC,WAAW,CAAC;IACjC,aAAa;IACb,UAAU,CAAC,KAAK,MAAM;QACpB,MAAM,eAAe,KAAK,GAAG,KAAK,MAAM,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK;QACnE,MAAM,YAAY,4GAAI,CAAC,OAAO,CAAC,KAAK,YAAY;QAChD,GAAG,MAAM,KAAK,SAAS,GAAG,MAAM,eAAe;IACjD;AACF;AAEA,MAAM,aAAa,CAAC,KAAK,MAAM;IAC7B,IAAI,KAAK,QAAQ,CAAC,UAAU,CAAC,WAAW;QACtC,GAAG,MAAM;IACX,OAAO;QACL,GAAG,IAAI,MAAM,kCAAkC;IACjD;AACF;AAEA,qCAAqC;AACrC,MAAM,SAAS,IAAA,gHAAM,EAAC;IACpB,SAAS;IACT,YAAY;IACZ,QAAQ;QAAE,UAAU,IAAI,OAAO;IAAK;AACtC;AAGO,MAAM,SAAS;IACpB,KAAK;QACH,YAAY;IACd;AACF;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,IAAI,SAAS,CAAC,SAAS;YAAC;SAAO;QAC/B,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,IAAI,MAAM,CAAC,YAAY,CAAC;IAC/D;IAEA,IAAI;QACF,2CAA2C;QAC3C,MAAM,cAAc,KAAK,KAAK,OAAO,MAAM,CAAC;YAC1C;gBAAE,MAAM;gBAAiB,UAAU;YAAG;YACtC;gBAAE,MAAM;gBAAgB,UAAU;YAAE;SACrC;QAED,gDAAgD;QAChD,IAAI,CAAC,IAAI,KAAK,IAAK,OAAO,IAAI,CAAC,IAAI,KAAK,EAAE,MAAM,KAAK,GAAI;YACvD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAA0B;QACjE;QAEA,iCAAiC;QACjC,MAAM,OAAO,CAAC;QACd,IAAI,IAAI,KAAK,CAAC,aAAa,EAAE;YAC3B,KAAK,aAAa,GAAG,IAAI,KAAK,CAAC,aAAa,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC,SAAS,EAAE,KAAK,QAAQ,EAAE;QACtF;QACA,IAAI,IAAI,KAAK,CAAC,YAAY,EAAE;YAC1B,KAAK,YAAY,GAAG,IAAI,KAAK,CAAC,YAAY,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC,SAAS,EAAE,KAAK,QAAQ,EAAE;QACpF;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAC1B,SAAS;YACT,MAAM,KAAK,0CAA0C;QACvD;IAEF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO,IAAI;QAAwB;IAC9E;AACF","debugId":null}}]
}