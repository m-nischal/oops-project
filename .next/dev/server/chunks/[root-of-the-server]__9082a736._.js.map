{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/Project%20OOPS%202/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/Project%20OOPS%202/src/models/User.js"],"sourcesContent":["// src/models/User.js\nimport mongoose from \"mongoose\";\n\nconst { Schema } = mongoose; // Destructure Schema for use in sub-schema\n\n// --- UPDATED SUB-SCHEMA: Address (Updated for Geo-location and full name) ---\nconst addressSchema = new Schema({\n  label: { type: String, default: \"Home\" }, \n  firstName: { type: String }, // NEW\n  lastName: { type: String }, // NEW\n  addressLine1: { type: String, required: true }, // Main street address from Google\n  addressLine2: { type: String }, // NEW: For apartment, suite, etc.\n  city: { type: String, required: true },\n  state: { type: String },\n  pincode: { type: String }, \n  country: { type: String, required: true }, // NEW\n  phone: { type: String }, \n  countryCode: { type: String, default: \"+91\" }, // NEW\n  // NEW: GeoJSON structure for map display and future distance queries\n  location: {\n    type: { type: String, enum: ['Point'], default: 'Point' },\n    coordinates: { type: [Number], default: undefined }, // [longitude, latitude]\n  },\n}, { _id: true });\n// --- END UPDATED SUB-SCHEMA ---\n\nconst userSchema = new mongoose.Schema({\n  name: { type: String },\n  email: { type: String, index: true, sparse: true, unique: true },\n  password: { type: String, select: false },\n  oauthProvider: String,\n  oauthId: String,\n  phone: { type: String },\n  role: { type: String, enum: [\"CUSTOMER\",\"RETAILER\",\"WHOLESALER\"], default: \"CUSTOMER\" },\n  verified: { type: Boolean, default: false },\n  otp: {\n    code: String,\n    expiresAt: Date\n  },\n  resetOtp: { type: String },\n  resetOtpExpiry: { type: Number },\n  resetAttempts: { type: Number },\n  addresses: [addressSchema]\n}, { timestamps: true });\n\nexport default mongoose.models.User || mongoose.model(\"User\", userSchema);"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AACrB;;AAEA,MAAM,EAAE,MAAM,EAAE,GAAG,oHAAQ,EAAE,2CAA2C;AAExE,+EAA+E;AAC/E,MAAM,gBAAgB,IAAI,OAAO;IAC/B,OAAO;QAAE,MAAM;QAAQ,SAAS;IAAO;IACvC,WAAW;QAAE,MAAM;IAAO;IAC1B,UAAU;QAAE,MAAM;IAAO;IACzB,cAAc;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC7C,cAAc;QAAE,MAAM;IAAO;IAC7B,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,OAAO;QAAE,MAAM;IAAO;IACtB,SAAS;QAAE,MAAM;IAAO;IACxB,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,OAAO;QAAE,MAAM;IAAO;IACtB,aAAa;QAAE,MAAM;QAAQ,SAAS;IAAM;IAC5C,qEAAqE;IACrE,UAAU;QACR,MAAM;YAAE,MAAM;YAAQ,MAAM;gBAAC;aAAQ;YAAE,SAAS;QAAQ;QACxD,aAAa;YAAE,MAAM;gBAAC;aAAO;YAAE,SAAS;QAAU;IACpD;AACF,GAAG;IAAE,KAAK;AAAK;AACf,iCAAiC;AAEjC,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,MAAM;QAAE,MAAM;IAAO;IACrB,OAAO;QAAE,MAAM;QAAQ,OAAO;QAAM,QAAQ;QAAM,QAAQ;IAAK;IAC/D,UAAU;QAAE,MAAM;QAAQ,QAAQ;IAAM;IACxC,eAAe;IACf,SAAS;IACT,OAAO;QAAE,MAAM;IAAO;IACtB,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAW;YAAW;SAAa;QAAE,SAAS;IAAW;IACtF,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,KAAK;QACH,MAAM;QACN,WAAW;IACb;IACA,UAAU;QAAE,MAAM;IAAO;IACzB,gBAAgB;QAAE,MAAM;IAAO;IAC/B,eAAe;QAAE,MAAM;IAAO;IAC9B,WAAW;QAAC;KAAc;AAC5B,GAAG;IAAE,YAAY;AAAK;uCAEP,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ","debugId":null}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/Project%20OOPS%202/src/lib/auth.js"],"sourcesContent":["import jwt from \"jsonwebtoken\";\n\nexport function verifyToken(req) {\n  const auth = req.headers.authorization;\n  if (!auth) throw new Error(\"No token\");\n  const token = auth.split(\" \")[1];\n  return jwt.verify(token, process.env.JWT_SECRET);\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,YAAY,GAAG;IAC7B,MAAM,OAAO,IAAI,OAAO,CAAC,aAAa;IACtC,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAC3B,MAAM,QAAQ,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE;IAChC,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;AACjD","debugId":null}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/Project%20OOPS%202/src/pages/api/user/profile.js"],"sourcesContent":["// src/pages/api/user/profile.js\nimport dbConnect from \"../../../lib/dbConnect\";\nimport User from \"../../../models/User\";\nimport { verifyToken } from \"../../../lib/auth\";\nimport mongoose from \"mongoose\";\n\nexport default async function handler(req, res) {\n  await dbConnect();\n\n  // 1. Authentication: Extract payload (user ID, role)\n  let payload;\n  try {\n    payload = verifyToken(req);\n  } catch (err) {\n    return res.status(401).json({ error: \"Unauthorized. Invalid token.\" });\n  }\n\n  const userId = new mongoose.Types.ObjectId(payload.id);\n\n  // GET: Fetch user profile (Selecting 'phone' field)\n  if (req.method === \"GET\") {\n    try {\n      const user = await User.findById(userId).select(\"name email role addresses phone\").lean();\n      if (!user) {\n        return res.status(404).json({ error: \"User not found.\" });\n      }\n      return res.status(200).json({ user });\n    } catch (err) {\n      console.error(\"GET /api/user/profile error:\", err);\n      return res.status(500).json({ error: \"Failed to fetch profile.\" });\n    }\n  }\n\n  // PUT: Update user profile (name, addresses, phone)\n  if (req.method === \"PUT\") {\n    try {\n      const { name, addresses, phone } = req.body;\n      \n      const updateFields = {};\n      if (name !== undefined) updateFields.name = String(name).trim();\n      // Added phone to update fields\n      if (phone !== undefined) updateFields.phone = String(phone).trim(); \n\n      if (addresses !== undefined && Array.isArray(addresses)) {\n        updateFields.addresses = addresses;\n      }\n      \n      const updatedUser = await User.findByIdAndUpdate(\n        userId,\n        { $set: updateFields },\n        { new: true, runValidators: true }\n      ).select(\"name email role addresses phone\").lean(); // Select phone on return\n\n      if (!updatedUser) {\n        return res.status(404).json({ error: \"User not found.\" });\n      }\n      \n      return res.status(200).json({ user: updatedUser });\n    } catch (err) {\n      console.error(\"PUT /api/user/profile error:\", err);\n      return res.status(400).json({ error: err.message || \"Failed to update profile.\" });\n    }\n  }\n\n  res.setHeader(\"Allow\", [\"GET\", \"PUT\"]);\n  return res.status(405).end(`Method ${req.method} Not Allowed`);\n}"],"names":[],"mappings":"AAAA,gCAAgC;;;;;AAChC;AACA;AACA;AACA;;;;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,IAAA,2HAAS;IAEf,qDAAqD;IACrD,IAAI;IACJ,IAAI;QACF,UAAU,IAAA,0HAAW,EAAC;IACxB,EAAE,OAAO,KAAK;QACZ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA+B;IACtE;IAEA,MAAM,SAAS,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,EAAE;IAErD,oDAAoD;IACpD,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,IAAI;YACF,MAAM,OAAO,MAAM,yHAAI,CAAC,QAAQ,CAAC,QAAQ,MAAM,CAAC,mCAAmC,IAAI;YACvF,IAAI,CAAC,MAAM;gBACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,OAAO;gBAAkB;YACzD;YACA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE;YAAK;QACrC,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAA2B;QAClE;IACF;IAEA,oDAAoD;IACpD,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,IAAI,IAAI;YAE3C,MAAM,eAAe,CAAC;YACtB,IAAI,SAAS,WAAW,aAAa,IAAI,GAAG,OAAO,MAAM,IAAI;YAC7D,+BAA+B;YAC/B,IAAI,UAAU,WAAW,aAAa,KAAK,GAAG,OAAO,OAAO,IAAI;YAEhE,IAAI,cAAc,aAAa,MAAM,OAAO,CAAC,YAAY;gBACvD,aAAa,SAAS,GAAG;YAC3B;YAEA,MAAM,cAAc,MAAM,yHAAI,CAAC,iBAAiB,CAC9C,QACA;gBAAE,MAAM;YAAa,GACrB;gBAAE,KAAK;gBAAM,eAAe;YAAK,GACjC,MAAM,CAAC,mCAAmC,IAAI,IAAI,yBAAyB;YAE7E,IAAI,CAAC,aAAa;gBAChB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,OAAO;gBAAkB;YACzD;YAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,MAAM;YAAY;QAClD,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO,IAAI,OAAO,IAAI;YAA4B;QAClF;IACF;IAEA,IAAI,SAAS,CAAC,SAAS;QAAC;QAAO;KAAM;IACrC,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,IAAI,MAAM,CAAC,YAAY,CAAC;AAC/D","debugId":null}}]
}