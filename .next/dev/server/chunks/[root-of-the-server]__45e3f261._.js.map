{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/models/User.js"],"sourcesContent":["// src/models/User.js\nimport mongoose from \"mongoose\";\n\nconst userSchema = new mongoose.Schema({\n  name: { type: String },\n  email: { type: String, index: true, sparse: true, unique: true },\n  password: { type: String, select: false },\n  oauthProvider: String,\n  oauthId: String,\n  role: { type: String, enum: [\"CUSTOMER\",\"RETAILER\",\"WHOLESALER\"], default: \"CUSTOMER\" },\n  verified: { type: Boolean, default: false },\n  otp: {\n    code: String,\n    expiresAt: Date\n  },\n  resetOtp: { type: String },\n  resetOtpExpiry: { type: Number },\n  resetAttempts: { type: Number }\n}, { timestamps: true });\n\nexport default mongoose.models.User || mongoose.model(\"User\", userSchema);\n"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AACrB;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,MAAM;QAAE,MAAM;IAAO;IACrB,OAAO;QAAE,MAAM;QAAQ,OAAO;QAAM,QAAQ;QAAM,QAAQ;IAAK;IAC/D,UAAU;QAAE,MAAM;QAAQ,QAAQ;IAAM;IACxC,eAAe;IACf,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAW;YAAW;SAAa;QAAE,SAAS;IAAW;IACtF,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,KAAK;QACH,MAAM;QACN,WAAW;IACb;IACA,UAAU;QAAE,MAAM;IAAO;IACzB,gBAAgB;QAAE,MAAM;IAAO;IAC/B,eAAe;QAAE,MAAM;IAAO;AAChC,GAAG;IAAE,YAAY;AAAK;uCAEP,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ","debugId":null}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/pages/api/auth/forgot/request.js"],"sourcesContent":["// src/pages/api/auth/forgot/request.js\r\nimport dbConnect from \"../../../../lib/dbConnect\";\r\nimport User from \"../../../../models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport nodemailer from \"nodemailer\";\r\n\r\nconst OTP_TTL_MS = 10 * 60 * 1000; // 10 minutes\r\n\r\nfunction resetPasswordEmailHtml({ appName = \"LiveMart\", otp, expiryMinutes = 10 }) {\r\n  return `\r\n  <div style=\"font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7;\">\r\n    <div style=\"max-width: 600px; margin: auto; background: #ffffff; padding: 24px; border-radius: 8px;\">\r\n      <h2 style=\"color:#222; margin-bottom:6px;\">${appName} — Password Reset</h2>\r\n      <p style=\"color:#555; margin-top:0;\">\r\n        We received a request to reset the password for your account. Use the code below to continue.\r\n      </p>\r\n\r\n      <div style=\"margin:22px 0; text-align:center;\">\r\n        <div style=\"display:inline-block; padding:14px 22px; border-radius:8px; background:#fff0f0;\">\r\n          <span style=\"font-size:28px; font-weight:700; letter-spacing:6px; color:#d5182a;\">\r\n            ${otp}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <p style=\"color:#777; font-size:14px;\">\r\n        This code is valid for ${expiryMinutes} minutes. If you did not request a password reset, ignore this message.\r\n      </p>\r\n\r\n      <p style=\"color:#999; font-size:13px; margin-top:18px;\">\r\n        — ${appName} Team\r\n      </p>\r\n    </div>\r\n  </div>\r\n  `;\r\n}\r\n\r\nexport default async function handler(req, res) {\r\n  await dbConnect();\r\n\r\n  if (req.method !== \"POST\") {\r\n    return res.status(405).json({ ok: false, message: \"Method not allowed\" });\r\n  }\r\n\r\n  const { email } = req.body || {};\r\n  if (!email || String(email).trim().length === 0) {\r\n    return res.status(400).json({ ok: false, message: \"Email required\" });\r\n  }\r\n\r\n  try {\r\n    const normalized = String(email).toLowerCase().trim();\r\n\r\n    // find or create user\r\n    let user = await User.findOne({ email: normalized });\r\n    if (!user) {\r\n      // create a user record with no password (OTP-only account)\r\n      user = new User({ email: normalized });\r\n    }\r\n\r\n    // generate OTP and store hashed version + expiry\r\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const hashed = await bcrypt.hash(otp, 10);\r\n    user.resetOtp = hashed;\r\n    user.resetOtpExpiry = Date.now() + OTP_TTL_MS;\r\n    user.resetAttempts = 0;\r\n    await user.save();\r\n\r\n    // create transporter\r\n    const transporter = nodemailer.createTransport({\r\n      host: process.env.SMTP_HOST,\r\n      port: Number(process.env.SMTP_PORT || 587),\r\n      secure: String(process.env.SMTP_PORT) === \"465\", // true for 465, false for 587\r\n      auth: { user: process.env.SMTP_USER, pass: process.env.SMTP_PASS },\r\n    });\r\n\r\n    // verify transporter (helpful for debugging)\r\n    try {\r\n      await transporter.verify();\r\n      console.log(\"SMTP verify OK\");\r\n    } catch (verifyErr) {\r\n      console.warn(\"SMTP verify failed:\", verifyErr && verifyErr.message ? verifyErr.message : verifyErr);\r\n      // we continue — dev fallback below will help when SMTP isn't configured\r\n    }\r\n\r\n    // build email content\r\n    const subject = \"Reset your LiveMart password\";\r\n    const html = resetPasswordEmailHtml({ otp, expiryMinutes: 10 });\r\n\r\n    try {\r\n      await transporter.sendMail({\r\n        from: process.env.FROM_EMAIL || process.env.SMTP_USER,\r\n        to: user.email,\r\n        subject,\r\n        html,\r\n        text: `Your LiveMart password reset code is ${otp}. It expires in 10 minutes.`,\r\n      });\r\n\r\n      return res.status(200).json({ ok: true, message: \"OTP sent\" });\r\n    } catch (mailErr) {\r\n      console.error(\"Error sending OTP mail:\", mailErr && mailErr.stack ? mailErr.stack : mailErr);\r\n\r\n      // Dev fallback — return OTP so you can test locally (DO NOT use in production)\r\n      if (process.env.NODE_ENV === \"development\") {\r\n        console.log(`[DEV OTP] ${user.email} -> ${otp}`);\r\n        return res.status(200).json({ ok: true, message: \"OTP (dev) returned\", otp });\r\n      }\r\n\r\n      return res.status(500).json({ ok: false, message: \"Failed to send OTP email\" });\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Forgot/request error:\", err && err.stack ? err.stack : err);\r\n    return res.status(500).json({ ok: false, message: \"Server error\" });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}