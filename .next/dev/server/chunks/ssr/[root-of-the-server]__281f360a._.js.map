{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/pages/register.js"],"sourcesContent":["// replace existing handleVerifyOtp in src/pages/register.js with this\nasync function handleVerifyOtp(e) {\n  e.preventDefault(); // form submission for final registration\n  setMessage(\"\");\n\n  const trimmedEmail = email.trim().toLowerCase();\n  const code = String(otp || \"\").trim();\n\n  if (!isProbablyEmail(trimmedEmail) || !code) {\n    setMessage(\"Email and OTP required\");\n    return;\n  }\n  if (!password || password.length < 6) {\n    setMessage(\"Please enter a password (min 6 chars) to finish registration.\");\n    return;\n  }\n\n  setLoading(true);\n  try {\n    // send otp + password together to verify endpoint (server should set password and return token)\n    const verifyRes = await fetch(\"/api/auth/otp/verify\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        email: trimmedEmail,\n        // backend accepts either `otp` or `code` â€” here we send `otp`\n        otp: code,\n        purpose: \"register\",\n        password: password\n      }),\n    });\n\n    const verifyData = await verifyRes.json().catch(() => null);\n\n    if (!verifyData) {\n      setMessage(\"Server returned an invalid response during OTP verify.\");\n      setLoading(false);\n      return;\n    }\n\n    if (!verifyRes.ok || !verifyData.ok) {\n      setMessage(verifyData.message || \"Invalid OTP or verification failed\");\n      setLoading(false);\n      return;\n    }\n\n    // SUCCESS: If backend returns a token, save it and redirect\n    if (verifyData.token) {\n      try {\n        localStorage.setItem(\"token\", verifyData.token);\n        localStorage.removeItem(\"guest_browsing\");\n      } catch (e) {\n        // ignore localStorage errors\n      }\n\n      try {\n        const payload = JSON.parse(atob(verifyData.token.split(\".\")[1]));\n        if (payload.role === \"RETAILER\") window.location.href = \"/retailer/dashboard\";\n        else if (payload.role === \"WHOLESALER\") window.location.href = \"/wholesaler/dashboard\";\n        else window.location.href = \"/customer/home\";\n        return;\n      } catch (err) {\n        // fallback\n        window.location.href = \"/\";\n        return;\n      }\n    }\n\n    // fallback success message\n    setMessage(\"Registration complete. Please login.\");\n  } catch (err) {\n    console.error(\"Verify/register error:\", err);\n    setMessage(\"Network/server error. Try again.\");\n  } finally {\n    setLoading(false);\n  }\n}\n"],"names":[],"mappings":"AAAA,sEAAsE;;AACtE,eAAe,gBAAgB,CAAC;IAC9B,EAAE,cAAc,IAAI,yCAAyC;IAC7D,WAAW;IAEX,MAAM,eAAe,MAAM,IAAI,GAAG,WAAW;IAC7C,MAAM,OAAO,OAAO,OAAO,IAAI,IAAI;IAEnC,IAAI,CAAC,gBAAgB,iBAAiB,CAAC,MAAM;QAC3C,WAAW;QACX;IACF;IACA,IAAI,CAAC,YAAY,SAAS,MAAM,GAAG,GAAG;QACpC,WAAW;QACX;IACF;IAEA,WAAW;IACX,IAAI;QACF,gGAAgG;QAChG,MAAM,YAAY,MAAM,MAAM,wBAAwB;YACpD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,8DAA8D;gBAC9D,KAAK;gBACL,SAAS;gBACT,UAAU;YACZ;QACF;QAEA,MAAM,aAAa,MAAM,UAAU,IAAI,GAAG,KAAK,CAAC,IAAM;QAEtD,IAAI,CAAC,YAAY;YACf,WAAW;YACX,WAAW;YACX;QACF;QAEA,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,EAAE,EAAE;YACnC,WAAW,WAAW,OAAO,IAAI;YACjC,WAAW;YACX;QACF;QAEA,4DAA4D;QAC5D,IAAI,WAAW,KAAK,EAAE;YACpB,IAAI;gBACF,aAAa,OAAO,CAAC,SAAS,WAAW,KAAK;gBAC9C,aAAa,UAAU,CAAC;YAC1B,EAAE,OAAO,GAAG;YACV,6BAA6B;YAC/B;YAEA,IAAI;gBACF,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,WAAW,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;gBAC9D,IAAI,QAAQ,IAAI,KAAK,YAAY,OAAO,QAAQ,CAAC,IAAI,GAAG;qBACnD,IAAI,QAAQ,IAAI,KAAK,cAAc,OAAO,QAAQ,CAAC,IAAI,GAAG;qBAC1D,OAAO,QAAQ,CAAC,IAAI,GAAG;gBAC5B;YACF,EAAE,OAAO,KAAK;gBACZ,WAAW;gBACX,OAAO,QAAQ,CAAC,IAAI,GAAG;gBACvB;YACF;QACF;QAEA,2BAA2B;QAC3B,WAAW;IACb,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,WAAW;IACb,SAAU;QACR,WAAW;IACb;AACF","debugId":null}}]
}