{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/pages/forgot-password.js"],"sourcesContent":["// src/pages/forgot-password.js\r\nimport { useState } from \"react\";\r\n\r\n\r\nexport default function ForgotPasswordPage() {\r\n  const [step, setStep] = useState(1);\r\n  const [email, setEmail] = useState(\"\");\r\n  const [otp, setOtp] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [confirm, setConfirm] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [message, setMessage] = useState(null);\r\n  const [pwMismatch, setPwMismatch] = useState(false);\r\n\r\n  function checkConfirm(pw, conf) {\r\n    // immediate character-by-character validation:\r\n    setPwMismatch(conf.length > 0 && pw !== conf);\r\n  }\r\n\r\n  async function requestOtp(e) {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setMessage(null);\r\n    try {\r\n      const res = await fetch(\"/api/auth/forgot/request\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ email }),\r\n      });\r\n      const data = await res.json();\r\n      setMessage(data.message || (data.ok ? \"OTP sent (if account exists).\" : \"Failed\"));\r\n      setStep(2);\r\n    } catch (err) {\r\n      console.error(err);\r\n      setMessage(\"Server error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function verifyAndSet(e) {\r\n    e.preventDefault();\r\n    if (pwMismatch) {\r\n      setMessage(\"Confirm password does not match.\");\r\n      return;\r\n    }\r\n    if (!password || password.length < 6) {\r\n      setMessage(\"Password must be at least 6 characters.\");\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    setMessage(null);\r\n    try {\r\n      const res = await fetch(\"/api/auth/forgot/verify\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ email, otp, password }),\r\n      });\r\n      const data = await res.json();\r\n      if (data.ok) {\r\n        setMessage(\"Password changed. Redirect to login.\");\r\n        // optionally redirect to login\r\n        // router.push(\"/login\");\r\n      } else {\r\n        setMessage(data.message || \"Failed to set password\");\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      setMessage(\"Server error\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ maxWidth: 520, margin: \"2rem auto\", padding: 20 }}>\r\n      <h2>Forgot password</h2>\r\n      {step === 1 && (\r\n        <form onSubmit={requestOtp}>\r\n          <label>\r\n            Email\r\n            <input\r\n              required\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              style={{ display: \"block\", width: \"100%\", padding: 8, margin: \"8px 0\" }}\r\n            />\r\n          </label>\r\n          <button type=\"submit\" disabled={loading}>\r\n            {loading ? \"Sending...\" : \"Send OTP\"}\r\n          </button>\r\n        </form>\r\n      )}\r\n\r\n      {step === 2 && (\r\n        <form onSubmit={verifyAndSet}>\r\n          <label>\r\n            OTP (check your email)\r\n            <input\r\n              required\r\n              value={otp}\r\n              onChange={(e) => setOtp(e.target.value)}\r\n              style={{ display: \"block\", width: \"100%\", padding: 8, margin: \"8px 0\" }}\r\n            />\r\n          </label>\r\n\r\n          <label>\r\n            New password\r\n            <input\r\n              required\r\n              type=\"password\"\r\n              value={password}\r\n              onChange={(e) => {\r\n                setPassword(e.target.value);\r\n                checkConfirm(e.target.value, confirm);\r\n              }}\r\n              style={{ display: \"block\", width: \"100%\", padding: 8, margin: \"8px 0\" }}\r\n            />\r\n          </label>\r\n\r\n          <label>\r\n            Confirm password\r\n            <input\r\n              required\r\n              type=\"password\"\r\n              value={confirm}\r\n              onChange={(e) => {\r\n                setConfirm(e.target.value);\r\n                checkConfirm(password, e.target.value);\r\n              }}\r\n              style={{ display: \"block\", width: \"100%\", padding: 8, margin: \"8px 0\" }}\r\n            />\r\n          </label>\r\n\r\n          <div style={{ minHeight: 22 }}>\r\n            {confirm.length > 0 ? (\r\n              pwMismatch ? (\r\n                <div style={{ color: \"crimson\" }}>Confirm password does not match</div>\r\n              ) : (\r\n                <div style={{ color: \"green\" }}>Passwords match</div>\r\n              )\r\n            ) : null}\r\n          </div>\r\n\r\n          <button disabled={loading} type=\"submit\">{loading ? \"Setting...\" : \"Set password\"}</button>\r\n        </form>\r\n      )}\r\n\r\n      {message && <div style={{ marginTop: 12 }}>{message}</div>}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}