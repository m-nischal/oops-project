{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder%20copy/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder%20copy/src/models/Product.js"],"sourcesContent":["// src/models/Product.js\nimport mongoose from \"mongoose\";\n\nconst { Schema } = mongoose;\n\n/**\n * Review subdocument\n * - rating: number (1..5)\n * - comment: string\n * - author: optional (retailer/customer id or name)\n * - createdAt\n */\nconst ReviewSchema = new Schema({\n  rating: { type: Number, required: true, min: 1, max: 5 },\n  comment: { type: String, default: \"\" },\n  author: { type: String }, // you can replace with ObjectId ref later\n  createdAt: { type: Date, default: Date.now },\n});\n\n/**\n * Size variant schema:\n * - size (S, M, L, XL, 6M etc.)\n * - sku (optional)\n * - stock (number)\n * - price override (optional)\n */\nconst SizeVariantSchema = new Schema({\n  size: { type: String, required: true },\n  sku: { type: String },\n  stock: { type: Number, default: 0 },\n  price: { type: Number }, // optional per-size price\n});\n\n/**\n * Size chart (generic object). Example:\n * { \"S\": { chest: \"...\", length: \"...\" }, ... }\n */\nconst SizeChartSchema = new Schema({\n  chartName: { type: String }, // e.g., \"Men's Hoodies\"\n  data: { type: Schema.Types.Mixed }, // flexible object with per-size measurements\n}, { _id: false });\n\n/**\n * Warehouse / storage location\n * retailers / wholesalers provide this\n */\nconst WarehouseSchema = new Schema({\n  name: { type: String }, // \"Chennai Warehouse\"\n  address: { type: String },\n  city: { type: String },\n  state: { type: String },\n  country: { type: String },\n  pincode: { type: String },\n  // approximate lead time (in days) from this warehouse to deliver locally\n  leadTimeDays: { type: Number, default: 2 },\n  // optional geo coords (if you want to compute distance later)\n  location: {\n    type: { type: String, enum: ['Point'], default: 'Point' },\n    coordinates: { type: [Number], default: undefined }, // [lng, lat]\n  },\n}, { _id: false });\n\n/**\n * Product details object (clothing attributes)\n */\nconst ProductDetailsSchema = new Schema({\n  materialComposition: { type: String }, // \"60% Cotton, 40% Polyester\"\n  sleeveType: { type: String }, // \"Long Sleeve\"\n  materialType: { type: String }, // \"Polycotton\"\n  fitType: { type: String }, // \"Regular\"\n  length: { type: String }, // \"Standard Length\"\n  neckStyle: { type: String }, // \"Hooded Neck\"\n  countryOfOrigin: { type: String }, // \"India\"\n  // allow extra props\n  extras: { type: Schema.Types.Mixed },\n}, { _id: false });\n\nconst ProductSchema = new Schema({\n  name: { type: String, required: true, index: true },\n  slug: { type: String, index: true }, // create slugs if needed\n  description: { type: String },\n  brand: { type: String },\n  retailer: { type: String },\n  category: { type: String },\n  price: { type: Number, required: true },\n  // multiple pictures (store URLs)\n  images: [{ type: String }],\n  // stock per variant (sizes)\n  sizes: [SizeVariantSchema],\n  sizeChart: SizeChartSchema,\n  productDetails: ProductDetailsSchema,\n  // reviews\n  reviews: [ReviewSchema],\n  // warehouses where the product is stored\n  warehouses: [WarehouseSchema],\n  // general inventory: totalStock (derived field)\n  totalStock: { type: Number, default: 0 },\n  // any tags or metadata\n  tags: [String],\n  createdAt: { type: Date, default: Date.now },\n  updatedAt: { type: Date, default: Date.now },\n}, { timestamps: true });\n\n/**\n * helper to recalc totalStock\n */\nProductSchema.methods.recalculateStock = function () {\n  const sizeStock = (this.sizes || []).reduce((acc, s) => acc + (s.stock || 0), 0);\n  // Optionally we could add warehouse counts; using size stock as source of truth\n  this.totalStock = sizeStock;\n  return this.totalStock;\n};\n\n/**\n * get best delivery estimate for a given customer location object:\n * { city, state, country, pincode }\n *\n * Simple approach used here:\n * - If there's a warehouse in same pincode => return warehouse.leadTimeDays (fastest)\n * - else if same city => warehouse.leadTimeDays + 1\n * - else if same state => warehouse.leadTimeDays + 2\n * - else => warehouse.leadTimeDays + 4\n *\n * (This is a placeholder algorithm â€” you can replace with distance or courier API)\n */\nProductSchema.methods.estimateDeliveryTo = function (customerLocation = {}) {\n  const whs = this.warehouses || [];\n  if (!whs.length) return { estimatedDays: null, reason: \"no warehouses configured\" };\n\n  // find exact pincode match\n  const byPincode = whs.find(w => w.pincode && customerLocation.pincode && w.pincode === customerLocation.pincode);\n  if (byPincode) {\n    return { estimatedDays: byPincode.leadTimeDays, warehouse: byPincode, method: \"pincode-match\" };\n  }\n\n  // same city\n  const byCity = whs.find(w => w.city && customerLocation.city && w.city.toLowerCase() === customerLocation.city.toLowerCase());\n  if (byCity) {\n    return { estimatedDays: byCity.leadTimeDays + 1, warehouse: byCity, method: \"city-match\" };\n  }\n\n  // same state\n  const byState = whs.find(w => w.state && customerLocation.state && w.state.toLowerCase() === customerLocation.state.toLowerCase());\n  if (byState) {\n    return { estimatedDays: byState.leadTimeDays + 2, warehouse: byState, method: \"state-match\" };\n  }\n\n  // fallback: pick warehouse with smallest leadTimeDays and add generic shipping\n  const minWh = whs.reduce((min, w) => (!min || (w.leadTimeDays < min.leadTimeDays) ? w : min), null);\n  return { estimatedDays: (minWh ? minWh.leadTimeDays + 4 : null), warehouse: minWh, method: \"fallback\" };\n};\n\nexport default mongoose.models.Product || mongoose.model(\"Product\", ProductSchema);\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 331, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder%20copy/src/pages/api/products/estimate-delivery.js"],"sourcesContent":["// src/pages/api/products/estimate-delivery.js\n// src/pages/api/products/estimate-delivery.js\nimport dbConnect from \"lib/dbConnect\";\nimport Product from \"models/Product.js\";\nimport mongoose from \"mongoose\";\n\n\nexport default async function handler(req, res) {\n  await dbConnect();\n  if (req.method !== \"POST\") return res.status(405).end();\n\n  // Body: { productId, customerLocation: { city, state, country, pincode } }\n  const { productId, customerLocation } = req.body;\n  if (!productId || !mongoose.isValidObjectId(productId)) {\n    return res.status(400).json({ error: \"productId required\" });\n  }\n  const product = await Product.findById(productId);\n  if (!product) return res.status(404).json({ error: \"product not found\" });\n\n  const estimation = product.estimateDeliveryTo(customerLocation || {});\n  return res.status(200).json({ estimation });\n}\n"],"names":[],"mappings":"AAAA,8CAA8C;AAC9C,8CAA8C;;;;;AAC9C;AACA;AACA;;;;AAGe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,IAAA,2HAAS;IACf,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;IAErD,2EAA2E;IAC3E,MAAM,EAAE,SAAS,EAAE,gBAAgB,EAAE,GAAG,IAAI,IAAI;IAChD,IAAI,CAAC,aAAa,CAAC,oHAAQ,CAAC,eAAe,CAAC,YAAY;QACtD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IACA,MAAM,UAAU,MAAM,4HAAO,CAAC,QAAQ,CAAC;IACvC,IAAI,CAAC,SAAS,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAoB;IAEvE,MAAM,aAAa,QAAQ,kBAAkB,CAAC,oBAAoB,CAAC;IACnE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE;IAAW;AAC3C","debugId":null}}]
}