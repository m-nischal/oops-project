{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/SEM-3/OOPS/Project%20OOPS/Project%20OOPS/src/pages/api/upload.js"],"sourcesContent":["// src/pages/api/upload.js\r\nimport { createRouter } from 'next-connect';\r\nimport multer from 'multer';\r\nimport path from 'path';\r\n\r\n// --- Configuration for Multer (same as before) ---\r\nconst storage = multer.diskStorage({\r\n  destination: './public/uploads', //\r\n  filename: (req, file, cb) => {\r\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\r\n    const extension = path.extname(file.originalname);\r\n    cb(null, file.fieldname + '-' + uniqueSuffix + extension);\r\n  },\r\n});\r\n\r\nconst fileFilter = (req, file, cb) => {\r\n  if (file.mimetype.startsWith('image/')) {\r\n    cb(null, true);\r\n  } else {\r\n    cb(new Error('Only image files are allowed!'), false);\r\n  }\r\n};\r\n\r\nconst upload = multer({ \r\n  storage: storage,\r\n  fileFilter: fileFilter,\r\n  limits: { fileSize: 5 * 1024 * 1024 } // 5MB file size limit\r\n});\r\n\r\n// --- API Route Handler ---\r\nconst router = createRouter();\r\n\r\n// --- THIS IS THE CHANGE ---\r\n// Use .array() instead of .single()\r\n// 'productImages' is the new field name. Allows up to 10 images.\r\nrouter.use(upload.array('productImages', 10));\r\n\r\nrouter.post((req, res) => {\r\n  // --- THIS IS THE CHANGE ---\r\n  // req.file is now req.files (an array)\r\n  if (!req.files || req.files.length === 0) {\r\n    return res.status(400).json({ error: 'No files were uploaded.' });\r\n  }\r\n\r\n  // Map over all uploaded files and return their URLs\r\n  const urls = req.files.map(file => `/uploads/${file.filename}`);\r\n  \r\n  return res.status(200).json({ \r\n    message: 'Files uploaded successfully', \r\n    urls: urls // Return an array of URLs\r\n  });\r\n});\r\n\r\n// --- Config and Error Handler (same as before) ---\r\nexport const config = {\r\n  api: {\r\n    bodyParser: false,\r\n  },\r\n};\r\n\r\nconst onError = (err, req, res) => {\r\n  console.error(err.stack);\r\n  res.status(500).json({ error: err.message || 'Something went wrong!' });\r\n};\r\n\r\nexport default router.handler({\r\n  onError,\r\n});"],"names":[],"mappings":"AAAA,0BAA0B;;;;;;;AAC1B;AACA;AACA;;;;;;;;AAEA,oDAAoD;AACpD,MAAM,UAAU,gHAAM,CAAC,WAAW,CAAC;IACjC,aAAa;IACb,UAAU,CAAC,KAAK,MAAM;QACpB,MAAM,eAAe,KAAK,GAAG,KAAK,MAAM,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK;QACnE,MAAM,YAAY,4GAAI,CAAC,OAAO,CAAC,KAAK,YAAY;QAChD,GAAG,MAAM,KAAK,SAAS,GAAG,MAAM,eAAe;IACjD;AACF;AAEA,MAAM,aAAa,CAAC,KAAK,MAAM;IAC7B,IAAI,KAAK,QAAQ,CAAC,UAAU,CAAC,WAAW;QACtC,GAAG,MAAM;IACX,OAAO;QACL,GAAG,IAAI,MAAM,kCAAkC;IACjD;AACF;AAEA,MAAM,SAAS,IAAA,gHAAM,EAAC;IACpB,SAAS;IACT,YAAY;IACZ,QAAQ;QAAE,UAAU,IAAI,OAAO;IAAK,EAAE,sBAAsB;AAC9D;AAEA,4BAA4B;AAC5B,MAAM,SAAS,IAAA,8IAAY;AAE3B,6BAA6B;AAC7B,oCAAoC;AACpC,iEAAiE;AACjE,OAAO,GAAG,CAAC,OAAO,KAAK,CAAC,iBAAiB;AAEzC,OAAO,IAAI,CAAC,CAAC,KAAK;IAChB,6BAA6B;IAC7B,uCAAuC;IACvC,IAAI,CAAC,IAAI,KAAK,IAAI,IAAI,KAAK,CAAC,MAAM,KAAK,GAAG;QACxC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA0B;IACjE;IAEA,oDAAoD;IACpD,MAAM,OAAO,IAAI,KAAK,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC,SAAS,EAAE,KAAK,QAAQ,EAAE;IAE9D,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAC1B,SAAS;QACT,MAAM,KAAK,0BAA0B;IACvC;AACF;AAGO,MAAM,SAAS;IACpB,KAAK;QACH,YAAY;IACd;AACF;AAEA,MAAM,UAAU,CAAC,KAAK,KAAK;IACzB,QAAQ,KAAK,CAAC,IAAI,KAAK;IACvB,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO,IAAI,OAAO,IAAI;IAAwB;AACvE;uCAEe,OAAO,OAAO,CAAC;IAC5B;AACF","debugId":null}}]
}