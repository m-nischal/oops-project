{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder%20copy%203/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder%20copy%203/src/models/Product.js"],"sourcesContent":["// src/models/Product.js\nimport mongoose from \"mongoose\";\n\nconst { Schema } = mongoose;\n\n/**\n * Review subdocument\n * - rating: number (1..5)\n * - comment: string\n * - author: optional (retailer/customer id or name)\n * - createdAt\n */\nconst ReviewSchema = new Schema({\n  rating: { type: Number, required: true, min: 1, max: 5 },\n  comment: { type: String, default: \"\" },\n  author: { type: String }, // you can replace with ObjectId ref later\n  createdAt: { type: Date, default: Date.now },\n});\n\n/**\n * Size variant schema:\n * - size (S, M, L, XL, 6M etc.)\n * - sku (optional)\n * - stock (number)\n * - price override (optional)\n */\nconst SizeVariantSchema = new Schema({\n  size: { type: String, required: true },\n  sku: { type: String },\n  stock: { type: Number, default: 0 },\n  price: { type: Number }, // optional per-size price\n});\n\n/**\n * Size chart (generic object). Example:\n * { \"S\": { chest: \"...\", length: \"...\" }, ... }\n */\nconst SizeChartSchema = new Schema({\n  chartName: { type: String }, // e.g., \"Men's Hoodies\"\n  data: { type: Schema.Types.Mixed }, // flexible object with per-size measurements\n}, { _id: false });\n\n/**\n * Warehouse / storage location\n * retailers / wholesalers provide this\n */\nconst WarehouseSchema = new Schema({\n  name: { type: String }, // \"Chennai Warehouse\"\n  address: { type: String },\n  city: { type: String },\n  state: { type: String },\n  country: { type: String },\n  pincode: { type: String },\n  // approximate lead time (in days) from this warehouse to deliver locally\n  leadTimeDays: { type: Number, default: 2 },\n  // optional geo coords (if you want to compute distance later)\n  location: {\n    type: { type: String, enum: ['Point'], default: 'Point' },\n    coordinates: { type: [Number], default: undefined }, // [lng, lat]\n  },\n}, { _id: false });\n\n/**\n * Product details object (clothing attributes)\n */\nconst ProductDetailsSchema = new Schema({\n  materialComposition: { type: String }, // \"60% Cotton, 40% Polyester\"\n  sleeveType: { type: String }, // \"Long Sleeve\"\n  materialType: { type: String }, // \"Polycotton\"\n  fitType: { type: String }, // \"Regular\"\n  length: { type: String }, // \"Standard Length\"\n  neckStyle: { type: String }, // \"Hooded Neck\"\n  countryOfOrigin: { type: String }, // \"India\"\n  // allow extra props\n  extras: { type: Schema.Types.Mixed },\n}, { _id: false });\n\nconst ProductSchema = new Schema({\n  name: { type: String, required: true, index: true },\n  slug: { type: String, index: true }, // create slugs if needed\n  description: { type: String },\n  brand: { type: String },\n  retailer: { type: String },\n  category: { type: String },\n  price: { type: Number, required: true },\n  // multiple pictures (store URLs)\n  images: [{ type: String }],\n  // stock per variant (sizes)\n  sizes: [SizeVariantSchema],\n  sizeChart: SizeChartSchema,\n  productDetails: ProductDetailsSchema,\n  // reviews\n  reviews: [ReviewSchema],\n  // warehouses where the product is stored\n  warehouses: [WarehouseSchema],\n  // general inventory: totalStock (derived field)\n  totalStock: { type: Number, default: 0 },\n  // any tags or metadata\n  tags: [String],\n  createdAt: { type: Date, default: Date.now },\n  updatedAt: { type: Date, default: Date.now },\n}, { timestamps: true });\n\n/**\n * helper to recalc totalStock\n */\nProductSchema.methods.recalculateStock = function () {\n  const sizeStock = (this.sizes || []).reduce((acc, s) => acc + (s.stock || 0), 0);\n  // Optionally we could add warehouse counts; using size stock as source of truth\n  this.totalStock = sizeStock;\n  return this.totalStock;\n};\n\n/**\n * get best delivery estimate for a given customer location object:\n * { city, state, country, pincode }\n *\n * Simple approach used here:\n * - If there's a warehouse in same pincode => return warehouse.leadTimeDays (fastest)\n * - else if same city => warehouse.leadTimeDays + 1\n * - else if same state => warehouse.leadTimeDays + 2\n * - else => warehouse.leadTimeDays + 4\n *\n * (This is a placeholder algorithm — you can replace with distance or courier API)\n */\nProductSchema.methods.estimateDeliveryTo = function (customerLocation = {}) {\n  const whs = this.warehouses || [];\n  if (!whs.length) return { estimatedDays: null, reason: \"no warehouses configured\" };\n\n  // find exact pincode match\n  const byPincode = whs.find(w => w.pincode && customerLocation.pincode && w.pincode === customerLocation.pincode);\n  if (byPincode) {\n    return { estimatedDays: byPincode.leadTimeDays, warehouse: byPincode, method: \"pincode-match\" };\n  }\n\n  // same city\n  const byCity = whs.find(w => w.city && customerLocation.city && w.city.toLowerCase() === customerLocation.city.toLowerCase());\n  if (byCity) {\n    return { estimatedDays: byCity.leadTimeDays + 1, warehouse: byCity, method: \"city-match\" };\n  }\n\n  // same state\n  const byState = whs.find(w => w.state && customerLocation.state && w.state.toLowerCase() === customerLocation.state.toLowerCase());\n  if (byState) {\n    return { estimatedDays: byState.leadTimeDays + 2, warehouse: byState, method: \"state-match\" };\n  }\n\n  // fallback: pick warehouse with smallest leadTimeDays and add generic shipping\n  const minWh = whs.reduce((min, w) => (!min || (w.leadTimeDays < min.leadTimeDays) ? w : min), null);\n  return { estimatedDays: (minWh ? minWh.leadTimeDays + 4 : null), warehouse: minWh, method: \"fallback\" };\n};\n\nexport default mongoose.models.Product || mongoose.model(\"Product\", ProductSchema);\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 331, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder%20copy%203/src/domain/catalog.js"],"sourcesContent":["// src/domain/catalog.js\n\n/**\n * @file DomainProduct\n * @brief DB-agnostic domain representation for products with helper methods.\n *\n * This class intentionally does not perform persistence. Use it to validate,\n * manipulate and serialize product data in business logic layers.\n */\n\nfunction toNumberSafe(value, fallback = 0) {\n  if (value === undefined || value === null) return fallback;\n  if (typeof value === \"number\" && Number.isFinite(value)) return value;\n  const n = Number(value);\n  return Number.isFinite(n) ? n : fallback;\n}\n\nfunction toDateSafe(value) {\n  if (!value) return undefined;\n  const d = value instanceof Date ? value : new Date(value);\n  return Number.isNaN(d.getTime()) ? undefined : d;\n}\n\n/**\n * @typedef Size\n * @property {string} label\n * @property {number} stock\n */\n\n/**\n * @typedef Rating\n * @property {number} avg\n * @property {number} count\n */\n\n/**\n * @class DomainProduct\n */\nexport class DomainProduct {\n  /**\n   * @param {Object} params\n   * @param {string|any} [params._id]\n   * @param {string} params.name\n   * @param {number|string} params.price\n   * @param {number|string} [params.originalPrice=0]\n   * @param {string} [params.description=\"\"]\n   * @param {string[]} [params.materials=[]]\n   * @param {string[]} [params.images=[]]\n   * @param {Size[]} [params.sizes=[]]\n   * @param {Rating} [params.rating={avg:0,count:0}]\n   * @param {string} [params.category=\"General\"]\n   * @param {string|Date} [params.createdAt]\n   * @param {string|Date} [params.updatedAt]\n   */\n  constructor({\n    _id = undefined,\n    name,\n    price,\n    originalPrice = 0,\n    description = \"\",\n    materials = [],\n    images = [],\n    sizes = [],\n    rating = { avg: 0, count: 0 },\n    category = \"General\",\n    createdAt = undefined,\n    updatedAt = undefined,\n  } = {}) {\n    if (!name) throw new Error(\"Product requires a name\");\n    const parsedPrice = toNumberSafe(price, NaN);\n    if (Number.isNaN(parsedPrice)) throw new Error(\"Product price must be a number\");\n\n    this._id = _id;\n    this.name = String(name);\n    this.price = parsedPrice;\n    this.originalPrice = toNumberSafe(originalPrice, 0);\n    this.description = String(description || \"\");\n    this.materials = Array.isArray(materials) ? materials.map(String) : [];\n    this.images = Array.isArray(images) ? images.map(String) : [];\n    this.sizes = Array.isArray(sizes)\n      ? sizes.map(s => ({ label: String(s.label), stock: toNumberSafe(s.stock, 0) }))\n      : [];\n    this.rating = {\n      avg: (rating && typeof rating.avg === \"number\") ? rating.avg : toNumberSafe(rating?.avg, 0),\n      count: (rating && typeof rating.count === \"number\") ? rating.count : toNumberSafe(rating?.count, 0),\n    };\n    this.category = String(category || \"General\");\n    this.createdAt = toDateSafe(createdAt);\n    this.updatedAt = toDateSafe(updatedAt);\n  }\n\n  /**\n   * Create a DomainProduct from a Mongoose document or raw object.\n   * @param {Object} doc\n   * @returns {DomainProduct}\n   */\n  static fromDocument(doc = {}) {\n    const d = doc && typeof doc.toObject === \"function\" ? doc.toObject() : doc || {};\n    return new DomainProduct({\n      _id: d._id,\n      name: d.name,\n      price: d.price,\n      originalPrice: d.originalPrice,\n      description: d.description,\n      materials: d.materials,\n      images: d.images,\n      sizes: d.sizes,\n      rating: d.rating,\n      category: d.category,\n      createdAt: d.createdAt,\n      updatedAt: d.updatedAt,\n    });\n  }\n\n  /**\n   * Validate a plain payload (useful before saving).\n   * Throws an Error on invalid input, returns true on success.\n   * @param {Object} payload\n   * @returns {boolean}\n   */\n  static validate(payload = {}) {\n    if (!payload) throw new Error(\"Payload is required\");\n    if (!payload.name || String(payload.name).trim() === \"\") throw new Error(\"Product name is required\");\n    const price = toNumberSafe(payload.price, NaN);\n    if (Number.isNaN(price)) throw new Error(\"Product price must be a number\");\n    if (payload.sizes && !Array.isArray(payload.sizes)) throw new Error(\"sizes must be an array\");\n    return true;\n  }\n\n  /**\n   * Merge updates into this domain object safely.\n   * Does not perform full validation.\n   * @param {Object} updates\n   */\n  updateFrom(updates = {}) {\n    if (!updates || typeof updates !== \"object\") return;\n    if (updates.name !== undefined) this.name = String(updates.name);\n    if (updates.price !== undefined) this.price = toNumberSafe(updates.price, this.price);\n    if (updates.originalPrice !== undefined) this.originalPrice = toNumberSafe(updates.originalPrice, this.originalPrice);\n    if (updates.description !== undefined) this.description = String(updates.description);\n    if (updates.materials !== undefined) this.materials = Array.isArray(updates.materials) ? updates.materials.map(String) : this.materials;\n    if (updates.images !== undefined) this.images = Array.isArray(updates.images) ? updates.images.map(String) : this.images;\n    if (updates.sizes !== undefined && Array.isArray(updates.sizes)) {\n      this.sizes = updates.sizes.map(s => ({ label: String(s.label), stock: toNumberSafe(s.stock, 0) }));\n    }\n    if (updates.rating !== undefined) {\n      this.rating = {\n        avg: toNumberSafe(updates.rating.avg, this.rating.avg),\n        count: toNumberSafe(updates.rating.count, this.rating.count)\n      };\n    }\n    if (updates.category !== undefined) this.category = String(updates.category);\n    if (updates.updatedAt !== undefined) this.updatedAt = toDateSafe(updates.updatedAt);\n  }\n\n  /**\n   * Get discount percentage (rounded).\n   * @returns {number}\n   */\n  getDiscountPercent() {\n    const op = toNumberSafe(this.originalPrice, 0);\n    const p = toNumberSafe(this.price, 0);\n    if (!op || op <= 0 || p >= op) return 0;\n    const percent = ((op - p) / op) * 100;\n    return Math.round(percent);\n  }\n\n  /**\n   * Returns true if any size has stock > 0.\n   * @returns {boolean}\n   */\n  isInStock() {\n    if (!Array.isArray(this.sizes) || this.sizes.length === 0) return false;\n    return this.sizes.some(s => toNumberSafe(s.stock, 0) > 0);\n  }\n\n  /**\n   * Returns total available stock across all sizes (integer).\n   * @returns {number}\n   */\n  totalStock() {\n    if (!Array.isArray(this.sizes) || this.sizes.length === 0) return 0;\n    return this.sizes.reduce((sum, s) => sum + Math.max(0, toNumberSafe(s.stock, 0)), 0);\n  }\n\n  /**\n   * Add a new size or update an existing size's stock.\n   * @param {String} label\n   * @param {Number} stock\n   */\n  addOrUpdateSize(label, stock) {\n    if (!label) throw new Error(\"Size label is required\");\n    const sIndex = this.sizes.findIndex(s => s.label === label);\n    const normalizedStock = Math.max(0, toNumberSafe(stock, 0));\n    if (sIndex === -1) {\n      this.sizes.push({ label: String(label), stock: normalizedStock });\n    } else {\n      this.sizes[sIndex].stock = normalizedStock;\n    }\n  }\n\n  /**\n   * Decrease stock for a size by qty (domain-only, not persisted).\n   * @param {String} label\n   * @param {Number} qty\n   * @returns {boolean} success\n   */\n  decreaseStock(label, qty = 1) {\n    if (!label) throw new Error(\"Size label required\");\n    const index = this.sizes.findIndex(s => s.label === label);\n    if (index === -1) return false;\n    const available = toNumberSafe(this.sizes[index].stock, 0);\n    const useQty = Math.max(0, Math.floor(toNumberSafe(qty, 0)));\n    if (useQty <= 0) return false;\n    if (available < useQty) return false;\n    this.sizes[index].stock = available - useQty;\n    return true;\n  }\n\n  /**\n   * Increase stock for a size by qty (domain-only).\n   * If size doesn't exist, it will be added.\n   * @param {String} label\n   * @param {Number} qty\n   */\n  increaseStock(label, qty = 1) {\n    if (!label) throw new Error(\"Size label required\");\n    const index = this.sizes.findIndex(s => s.label === label);\n    const addQty = Math.max(0, Math.floor(toNumberSafe(qty, 0)));\n    if (addQty === 0) return;\n    if (index === -1) {\n      this.sizes.push({ label: String(label), stock: addQty });\n    } else {\n      this.sizes[index].stock = toNumberSafe(this.sizes[index].stock, 0) + addQty;\n    }\n  }\n\n  /**\n   * Convert domain object to a plain object suitable for saving with Mongoose.\n   * @param {Object} [opts]\n   * @param {Boolean} [opts.omitId=false]\n   * @returns {Object}\n   */\n  toObject(opts = {}) {\n    const obj = {\n      name: this.name,\n      price: this.price,\n      originalPrice: this.originalPrice,\n      description: this.description,\n      materials: Array.isArray(this.materials) ? this.materials : [],\n      images: Array.isArray(this.images) ? this.images : [],\n      sizes: Array.isArray(this.sizes) ? this.sizes.map(s => ({ label: s.label, stock: toNumberSafe(s.stock, 0) })) : [],\n      rating: {\n        avg: toNumberSafe(this.rating && this.rating.avg ? this.rating.avg : 0),\n        count: toNumberSafe(this.rating && this.rating.count ? this.rating.count : 0),\n      },\n      category: this.category || \"General\",\n    };\n\n    if (!opts.omitId && this._id) obj._id = this._id;\n    if (this.createdAt) obj.createdAt = this.createdAt;\n    if (this.updatedAt) obj.updatedAt = this.updatedAt;\n    return obj;\n  }\n\n  /**\n   * toJSON for safe serialization (JSON.stringify)\n   * @returns {Object}\n   */\n  toJSON() {\n    const o = this.toObject({ omitId: false });\n    if (o._id !== undefined && (typeof o._id === \"object\" || typeof o._id === \"string\")) {\n      o.id = String(o._id);\n    }\n    return o;\n  }\n\n  /**\n   * Create a deep clone of this object.\n   * @returns {DomainProduct}\n   */\n  clone() {\n    return DomainProduct.fromDocument(JSON.parse(JSON.stringify(this.toObject())));\n  }\n}\n\nexport default DomainProduct;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 585, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder%20copy%203/src/services/catalogService.js"],"sourcesContent":["// src/services/catalogService.js\nimport ProductModel from \"models/Product.js\";\nimport DomainProduct from \"domain/catalog.js\";\n\n/**\n * @class CatalogService\n * @brief Service layer for product catalog operations (create/update/search/get).\n *\n * This service translates between Mongoose documents and the DomainProduct\n * class. Controllers should call these methods — the service handles DB calls,\n * mapping and basic patterns like pagination & text search.\n */\nexport default class CatalogService {\n  /**\n   * Create a new product document and return a DomainProduct instance.\n   * @param {Object} data - product payload compatible with productModel / DomainProduct\n   * @returns {Promise<DomainProduct>} created product (domain)\n   */\n  static async createProduct(data) {\n    const model = new ProductModel(data);\n    const saved = await model.save();\n    return DomainProduct.fromDocument(saved);\n  }\n\n  /**\n   * Update a product by id and return DomainProduct or null if not found.\n   * @param {String} id - product ObjectId or string\n   * @param {Object} updates - partial product fields to update\n   * @returns {Promise<DomainProduct|null>}\n   */\n  static async updateProduct(id, updates) {\n    const updated = await ProductModel.findByIdAndUpdate(id, updates, { new: true }).lean();\n    return updated ? DomainProduct.fromDocument(updated) : null;\n  }\n\n  /**\n   * Get a single product by id and map to DomainProduct.\n   * @param {String} id\n   * @returns {Promise<DomainProduct|null>}\n   */\n  static async getProductById(id) {\n    const doc = await ProductModel.findById(id).lean();\n    return doc ? DomainProduct.fromDocument(doc) : null;\n  }\n\n  /**\n   * Get a list of products with optional filtering, pagination and projection.\n   * Returns lean objects by default (fast for APIs showing current stock).\n   *\n   * @param {Object} filter - MongoDB filter\n   * @param {Object} opts - { lean=true/false, limit, skip, sort }\n   * @returns {Promise<Array|Object>} array of products (lean objects) or DomainProduct mapping\n   */\n  static async getProducts(filter = {}, opts = {}) {\n    const { lean = true, limit = 0, skip = 0, sort = { createdAt: -1 } } = opts;\n    let q = ProductModel.find(filter).sort(sort).skip(Number(skip)).limit(Number(limit));\n    if (lean) q = q.lean();\n    const docs = await q.exec();\n    if (!lean) return docs.map(d => DomainProduct.fromDocument(d));\n    return docs;\n  }\n\n  /**\n   * Search products with optional text query, pagination and inStock filter.\n   *\n   * When using the text query `q`, the productModel has a text index on\n   * name & description so results are matched. Consider sorting by score\n   * if relevance ordering is desired.\n   *\n   * @param {Object} opts\n   * @param {string} [opts.q] - full-text search string\n   * @param {number} [opts.page=1]\n   * @param {number} [opts.limit=20]\n   * @param {boolean} [opts.inStockOnly=false]\n   * @returns {Promise<{items: DomainProduct[], total:number, page:number, limit:number}>}\n   */\n  static async searchProducts({ q = \"\", page = 1, limit = 20, inStockOnly = false } = {}) {\n    const filter = {};\n    if (q) {\n      filter.$text = { $search: q };\n    }\n    if (inStockOnly) filter[\"sizes.stock\"] = { $gt: 0 };\n\n    const skip = Math.max(0, (Number(page) - 1) * Number(limit));\n    const docs = await ProductModel.find(filter).skip(skip).limit(Number(limit)).lean();\n    const total = await ProductModel.countDocuments(filter);\n    const items = docs.map(d => DomainProduct.fromDocument(d));\n    return { items, total, page: Number(page), limit: Number(limit) };\n  }\n}\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;AACjC;AACA;;;AAUe,MAAM;IACnB;;;;GAIC,GACD,aAAa,cAAc,IAAI,EAAE;QAC/B,MAAM,QAAQ,IAAI,4HAAY,CAAC;QAC/B,MAAM,QAAQ,MAAM,MAAM,IAAI;QAC9B,OAAO,4HAAa,CAAC,YAAY,CAAC;IACpC;IAEA;;;;;GAKC,GACD,aAAa,cAAc,EAAE,EAAE,OAAO,EAAE;QACtC,MAAM,UAAU,MAAM,4HAAY,CAAC,iBAAiB,CAAC,IAAI,SAAS;YAAE,KAAK;QAAK,GAAG,IAAI;QACrF,OAAO,UAAU,4HAAa,CAAC,YAAY,CAAC,WAAW;IACzD;IAEA;;;;GAIC,GACD,aAAa,eAAe,EAAE,EAAE;QAC9B,MAAM,MAAM,MAAM,4HAAY,CAAC,QAAQ,CAAC,IAAI,IAAI;QAChD,OAAO,MAAM,4HAAa,CAAC,YAAY,CAAC,OAAO;IACjD;IAEA;;;;;;;GAOC,GACD,aAAa,YAAY,SAAS,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,EAAE;QAC/C,MAAM,EAAE,OAAO,IAAI,EAAE,QAAQ,CAAC,EAAE,OAAO,CAAC,EAAE,OAAO;YAAE,WAAW,CAAC;QAAE,CAAC,EAAE,GAAG;QACvE,IAAI,IAAI,4HAAY,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,MAAM,IAAI,CAAC,OAAO,OAAO,KAAK,CAAC,OAAO;QAC7E,IAAI,MAAM,IAAI,EAAE,IAAI;QACpB,MAAM,OAAO,MAAM,EAAE,IAAI;QACzB,IAAI,CAAC,MAAM,OAAO,KAAK,GAAG,CAAC,CAAA,IAAK,4HAAa,CAAC,YAAY,CAAC;QAC3D,OAAO;IACT;IAEA;;;;;;;;;;;;;GAaC,GACD,aAAa,eAAe,EAAE,IAAI,EAAE,EAAE,OAAO,CAAC,EAAE,QAAQ,EAAE,EAAE,cAAc,KAAK,EAAE,GAAG,CAAC,CAAC,EAAE;QACtF,MAAM,SAAS,CAAC;QAChB,IAAI,GAAG;YACL,OAAO,KAAK,GAAG;gBAAE,SAAS;YAAE;QAC9B;QACA,IAAI,aAAa,MAAM,CAAC,cAAc,GAAG;YAAE,KAAK;QAAE;QAElD,MAAM,OAAO,KAAK,GAAG,CAAC,GAAG,CAAC,OAAO,QAAQ,CAAC,IAAI,OAAO;QACrD,MAAM,OAAO,MAAM,4HAAY,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,MAAM,KAAK,CAAC,OAAO,QAAQ,IAAI;QACjF,MAAM,QAAQ,MAAM,4HAAY,CAAC,cAAc,CAAC;QAChD,MAAM,QAAQ,KAAK,GAAG,CAAC,CAAA,IAAK,4HAAa,CAAC,YAAY,CAAC;QACvD,OAAO;YAAE;YAAO;YAAO,MAAM,OAAO;YAAO,OAAO,OAAO;QAAO;IAClE;AACF","debugId":null}},
    {"offset": {"line": 679, "column": 0}, "map": {"version":3,"sources":["file:///Users/nischalreddymuthumula/Desktop/untitled%20folder%20copy%203/src/pages/api/products/index.js"],"sourcesContent":["// src/pages/api/products/index.js\nimport dbConnect from \"lib/dbConnect\";\nimport CatalogService from \"services/catalogService.js\"; // adjust path if your project resolves differently\n\nexport default async function handler(req, res) {\n  await dbConnect();\n\n  if (req.method === \"GET\") {\n    try {\n      const { categoryId, limit = 20, page = 1, q = \"\", inStockOnly, storefront } = req.query;\n      const filter = {};\n\n      // If caller passed categoryId, compute descendants if your Category model supports path\n      if (categoryId) {\n        // keep behaviour simple here; if you have getDescendantCategoryIds helper, call it.\n        filter.categories = { $in: [categoryId] };\n      }\n      if (storefront) filter.storefronts = storefront;\n      if (inStockOnly === \"true\") filter[\"sizes.stock\"] = { $gt: 0 };\n      if (q) filter.$text = { $search: q };\n\n      const skip = (Number(page) - 1) * Number(limit);\n      const products = await CatalogService.getProducts(filter, { lean: true, limit: Number(limit), skip, sort: { createdAt: -1 } });\n      const total = await (import(\"models/Product.js\").then(m => m.default.countDocuments(filter)));\n      return res.status(200).json({ items: products, total: await total });\n    } catch (err) {\n      console.error(\"GET /api/products error:\", err && (err.stack || err));\n      return res.status(500).json({ message: \"Failed to fetch products\" });\n    }\n  }\n\n  res.status(405).json({ message: \"Method not allowed\" });\n}\n"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAClC;AACA,yNAAyD,mDAAmD;;;AAE7F,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,IAAA,2HAAS;IAEf,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,IAAI;YACF,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,EAAE,OAAO,CAAC,EAAE,IAAI,EAAE,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,IAAI,KAAK;YACvF,MAAM,SAAS,CAAC;YAEhB,wFAAwF;YACxF,IAAI,YAAY;gBACd,oFAAoF;gBACpF,OAAO,UAAU,GAAG;oBAAE,KAAK;wBAAC;qBAAW;gBAAC;YAC1C;YACA,IAAI,YAAY,OAAO,WAAW,GAAG;YACrC,IAAI,gBAAgB,QAAQ,MAAM,CAAC,cAAc,GAAG;gBAAE,KAAK;YAAE;YAC7D,IAAI,GAAG,OAAO,KAAK,GAAG;gBAAE,SAAS;YAAE;YAEnC,MAAM,OAAO,CAAC,OAAO,QAAQ,CAAC,IAAI,OAAO;YACzC,MAAM,WAAW,MAAM,qIAAc,CAAC,WAAW,CAAC,QAAQ;gBAAE,MAAM;gBAAM,OAAO,OAAO;gBAAQ;gBAAM,MAAM;oBAAE,WAAW,CAAC;gBAAE;YAAE;YAC5H,MAAM,QAAQ,MAAO,4FAA4B,IAAI,CAAC,CAAA,IAAK,EAAE,OAAO,CAAC,cAAc,CAAC;YACpF,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;gBAAU,OAAO,MAAM;YAAM;QACpE,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,4BAA4B,OAAO,CAAC,IAAI,KAAK,IAAI,GAAG;YAClE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAA2B;QACpE;IACF;IAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,SAAS;IAAqB;AACvD","debugId":null}}]
}