{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/lib/dbConnect.js"],"sourcesContent":["// lib/dbConnect.js\nimport mongoose from \"mongoose\";\n\n/**\n * @file dbConnect\n * @brief Reusable MongoDB connection util for Next.js API routes.\n *\n * Throws if MONGO_URI missing. Caches connection in global to avoid multiple\n * connections during hot-reload/development.\n */\n\nconst MONGO_URI = process.env.MONGO_URI;\nif (!MONGO_URI) throw new Error(\"MONGO_URI not set\");\n\nlet cached = global._mongoose || { conn: null, promise: null };\nif (!global._mongoose) global._mongoose = cached;\n\n/**\n * Ensure there is a single mongoose connection used across calls.\n * @returns {Promise<mongoose.Mongoose>}\n */\nexport default async function dbConnect() {\n  if (cached.conn) return cached.conn;\n  if (!cached.promise) {\n    // Use the connection string directly; options are managed by mongoose v8 defaults.\n    cached.promise = mongoose.connect(MONGO_URI).then(m => m);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;AACnB;;AAEA;;;;;;CAMC,GAED,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS;AACvC,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;AAEhC,IAAI,SAAS,yDAAO,SAAS,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAC7D,IAAI,CAAC,yDAAO,SAAS,EAAE,yDAAO,SAAS,GAAG;AAM3B,eAAe;IAC5B,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,mFAAmF;QACnF,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,WAAW,IAAI,CAAC,CAAA,IAAK;IACzD;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/models/User.js"],"sourcesContent":["// src/models/User.js\nimport mongoose from \"mongoose\";\n\nconst userSchema = new mongoose.Schema({\n  name: { type: String },\n  email: { type: String, index: true, sparse: true, unique: true },\n  password: { type: String, select: false },\n  oauthProvider: String,\n  oauthId: String,\n  role: { type: String, enum: [\"CUSTOMER\",\"RETAILER\",\"WHOLESALER\"], default: \"CUSTOMER\" },\n  verified: { type: Boolean, default: false },\n  otp: {\n    code: String,\n    expiresAt: Date\n  },\n  resetOtp: { type: String },\n  resetOtpExpiry: { type: Number },\n  resetAttempts: { type: Number }\n}, { timestamps: true });\n\nexport default mongoose.models.User || mongoose.model(\"User\", userSchema);\n"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AACrB;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,MAAM;QAAE,MAAM;IAAO;IACrB,OAAO;QAAE,MAAM;QAAQ,OAAO;QAAM,QAAQ;QAAM,QAAQ;IAAK;IAC/D,UAAU;QAAE,MAAM;QAAQ,QAAQ;IAAM;IACxC,eAAe;IACf,SAAS;IACT,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAW;YAAW;SAAa;QAAE,SAAS;IAAW;IACtF,UAAU;QAAE,MAAM;QAAS,SAAS;IAAM;IAC1C,KAAK;QACH,MAAM;QACN,WAAW;IACb;IACA,UAAU;QAAE,MAAM;IAAO;IACzB,gBAAgB;QAAE,MAAM;IAAO;IAC/B,eAAe;QAAE,MAAM;IAAO;AAChC,GAAG;IAAE,YAAY;AAAK;uCAEP,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ","debugId":null}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/lib/emailTemplates.js"],"sourcesContent":["// lib/emailTemplates.js\r\nexport function otpEmailHtml({ appName = \"LiveMart\", otp, expiryMinutes = 10 }) {\r\n  return `\r\n  <div style=\"font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7;\">\r\n    <div style=\"max-width: 600px; margin: auto; background: #ffffff; padding: 24px; border-radius: 8px;\">\r\n      <h2 style=\"color: #222; margin-bottom: 6px;\">${appName} — Verification Code</h2>\r\n      <p style=\"color: #555; margin-top: 0;\">\r\n        Use the code below to verify your email address. The code expires in ${expiryMinutes} minutes.\r\n      </p>\r\n\r\n      <div style=\"margin: 22px 0; text-align: center;\">\r\n        <div style=\"display:inline-block; padding: 14px 22px; border-radius:8px; background:#f0f4ff;\">\r\n          <span style=\"font-size: 28px; font-weight: 700; letter-spacing: 6px; color: #1a56db;\">\r\n            ${otp}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <p style=\"color:#777; font-size:14px;\">\r\n        If you didn’t request this, you can safely ignore this email.\r\n      </p>\r\n\r\n      <p style=\"color:#999; font-size:13px; margin-top:18px;\">\r\n        — ${appName} Team\r\n      </p>\r\n    </div>\r\n  </div>\r\n  `;\r\n}\r\n\r\nexport function resetPasswordEmailHtml({ appName = \"LiveMart\", otp, expiryMinutes = 10 }) {\r\n  return `\r\n  <div style=\"font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7;\">\r\n    <div style=\"max-width: 600px; margin: auto; background: #ffffff; padding: 24px; border-radius: 8px;\">\r\n      <h2 style=\"color:#222; margin-bottom:6px;\">${appName} — Password Reset</h2>\r\n      <p style=\"color:#555; margin-top:0;\">\r\n        We received a request to reset the password for your account. Use the code below to continue.\r\n      </p>\r\n\r\n      <div style=\"margin:22px 0; text-align:center;\">\r\n        <div style=\"display:inline-block; padding:14px 22px; border-radius:8px; background:#fff0f0;\">\r\n          <span style=\"font-size:28px; font-weight:700; letter-spacing:6px; color:#d5182a;\">\r\n            ${otp}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <p style=\"color:#777; font-size:14px;\">\r\n        This code is valid for ${expiryMinutes} minutes. If you did not request a password reset, ignore this message.\r\n      </p>\r\n\r\n      <p style=\"color:#999; font-size:13px; margin-top:18px;\">\r\n        — ${appName} Team\r\n      </p>\r\n    </div>\r\n  </div>\r\n  `;\r\n}\r\n"],"names":[],"mappings":"AAAA,wBAAwB;;;;;;;AACjB,SAAS,aAAa,EAAE,UAAU,UAAU,EAAE,GAAG,EAAE,gBAAgB,EAAE,EAAE;IAC5E,OAAO,CAAC;;;mDAGyC,EAAE,QAAQ;;6EAEgB,EAAE,cAAc;;;;;;YAMjF,EAAE,IAAI;;;;;;;;;;UAUR,EAAE,QAAQ;;;;EAIlB,CAAC;AACH;AAEO,SAAS,uBAAuB,EAAE,UAAU,UAAU,EAAE,GAAG,EAAE,gBAAgB,EAAE,EAAE;IACtF,OAAO,CAAC;;;iDAGuC,EAAE,QAAQ;;;;;;;;YAQ/C,EAAE,IAAI;;;;;;+BAMa,EAAE,cAAc;;;;UAIrC,EAAE,QAAQ;;;;EAIlB,CAAC;AACH","debugId":null}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rajag/OneDrive/Desktop/vamsi/oops%20project/livemart-19112025/Project%20OOPS/src/pages/api/auth/forgot/request.js"],"sourcesContent":["// src/pages/api/auth/forgot/request.js\r\nimport dbConnect from \"../../../../lib/dbConnect\";\r\nimport User from \"../../../../models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport nodemailer from \"nodemailer\";\r\nimport { resetPasswordEmailHtml } from \"../../../../lib/emailTemplates\";\r\n\r\nconst OTP_TTL_MS = 10 * 60 * 1000; // 10 minutes\r\n\r\nasync function sendOtpMail({ to, otp }) {\r\n  const transporter = nodemailer.createTransport({\r\n    host: process.env.SMTP_HOST,\r\n    port: Number(process.env.SMTP_PORT || 587),\r\n    secure: String(process.env.SMTP_PORT) === \"465\", // true for 465\r\n    auth: {\r\n      user: process.env.SMTP_USER,\r\n      pass: process.env.SMTP_PASS,\r\n    },\r\n  });\r\n\r\n    const subject = \"Reset your LiveMart password\";\r\n    const html = resetPasswordEmailHtml({ otp, expiryMinutes: 10, appName: \"LiveMart\" });\r\n\r\n    await transporter.sendMail({\r\n    from: process.env.FROM_EMAIL || process.env.SMTP_USER,\r\n    to: user.email,\r\n    subject,\r\n    html,\r\n    text: `Your LiveMart password reset code is ${otp}. It expires in 10 minutes.`\r\n    });\r\n}\r\n\r\nexport default async function handler(req, res) {\r\n  await dbConnect();\r\n  if (req.method !== \"POST\") return res.status(405).json({ ok: false, message: \"Method not allowed\" });\r\n\r\n  try {\r\n    const { email } = req.body;\r\n    if (!email) return res.status(400).json({ ok: false, message: \"Email required\" });\r\n\r\n    const user = await User.findOne({ email: email.toLowerCase() });\r\n    if (!user) {\r\n      // Do not reveal whether user exists — but we still respond OK to avoid user enumeration\r\n      return res.status(200).json({ ok: true, message: \"If an account with that email exists, an OTP has been sent.\" });\r\n    }\r\n\r\n    // generate 6-digit OTP\r\n    const otp = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const otpHash = await bcrypt.hash(otp, 10);\r\n    user.resetOtp = otpHash;\r\n    user.resetOtpExpiry = Date.now() + OTP_TTL_MS;\r\n    user.resetAttempts = 0;\r\n    await user.save();\r\n\r\n    try {\r\n      await sendOtpMail({ to: user.email, otp });\r\n    } catch (mailErr) {\r\n      console.error(\"Error sending OTP mail:\", mailErr);\r\n      // don't return detailed mail error to user\r\n      return res.status(500).json({ ok: false, message: \"Failed to send OTP email\" });\r\n    }\r\n\r\n    return res.status(200).json({ ok: true, message: \"If an account exists, an OTP was sent.\" });\r\n  } catch (err) {\r\n    console.error(\"forgot request error:\", err);\r\n    return res.status(500).json({ ok: false, message: \"Server error\" });\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,uCAAuC;;;;;AACvC;AACA;AACA;AACA;AACA;;;;;;;;;;AAEA,MAAM,aAAa,KAAK,KAAK,MAAM,aAAa;AAEhD,eAAe,YAAY,EAAE,EAAE,EAAE,GAAG,EAAE;IACpC,MAAM,cAAc,wHAAU,CAAC,eAAe,CAAC;QAC7C,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC3B,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS,IAAI;QACtC,QAAQ,OAAO,QAAQ,GAAG,CAAC,SAAS,MAAM;QAC1C,MAAM;YACJ,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC7B;IACF;IAEE,MAAM,UAAU;IAChB,MAAM,OAAO,IAAA,gKAAsB,EAAC;QAAE;QAAK,eAAe;QAAI,SAAS;IAAW;IAElF,MAAM,YAAY,QAAQ,CAAC;QAC3B,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI,QAAQ,GAAG,CAAC,SAAS;QACrD,IAAI,KAAK,KAAK;QACd;QACA;QACA,MAAM,CAAC,qCAAqC,EAAE,IAAI,2BAA2B,CAAC;IAC9E;AACJ;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,IAAA,4IAAS;IACf,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,IAAI;QAAO,SAAS;IAAqB;IAElG,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,IAAI;QAC1B,IAAI,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS;QAAiB;QAE/E,MAAM,QAAO,MAAM,0IAAI,CAAC,OAAO,CAAC;YAAE,OAAO,MAAM,WAAW;QAAG;QAC7D,IAAI,CAAC,OAAM;YACT,wFAAwF;YACxF,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,IAAI;gBAAM,SAAS;YAA8D;QACjH;QAEA,uBAAuB;QACvB,MAAM,MAAM,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;QAChE,MAAM,UAAU,MAAM,2HAAM,CAAC,IAAI,CAAC,KAAK;QACvC,MAAK,QAAQ,GAAG;QAChB,MAAK,cAAc,GAAG,KAAK,GAAG,KAAK;QACnC,MAAK,aAAa,GAAG;QACrB,MAAM,MAAK,IAAI;QAEf,IAAI;YACF,MAAM,YAAY;gBAAE,IAAI,MAAK,KAAK;gBAAE;YAAI;QAC1C,EAAE,OAAO,SAAS;YAChB,QAAQ,KAAK,CAAC,2BAA2B;YACzC,2CAA2C;YAC3C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,IAAI;gBAAO,SAAS;YAA2B;QAC/E;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;QAAyC;IAC5F,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,SAAS;QAAe;IACnE;AACF","debugId":null}}]
}